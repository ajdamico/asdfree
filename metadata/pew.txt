chapter_title: Pew Research Center

needs_local_build_status_line: yes

~~~{dataset_introduction}
The Pew Research Center releases its survey microdata on U.S. Politics & Policy, Journalism & Media, Internet, Science & Tech, Religion & Public Life, Hispanic Trends, Global Attitudes & Trends, and Social & Demographic Trends.
~~~

table_structure: * Generally one table per survey, with one row per sampled respondent.

generalizable_population: * Complex sample surveys, often designed to generalize to the U.S. noninstitutionalized adult population or the adult populations of the nations surveyed.

publication_period: * Varying publication dates for both [American Trends Panel](https://www.pewresearch.org/our-methods/u-s-surveys/the-american-trends-panel/) surveys of the United States and also for [International Surveys](https://www.pewresearch.org/our-methods/international-surveys/).  [National Public Opinion Reference Survey](https://www.pewresearch.org/methods/2021/05/03/how-pew-research-center-uses-its-national-public-opinion-reference-survey-npors/) released annually since 2020

administrative_organization: * Administered by the [Pew Research Center](http://www.pewresearch.org/).


~~~{reading_block}
Please skim before you begin:

1. 

2. Country Specific Methodology, for example the [2022 Global Attitudes Survey](https://www.pewresearch.org/methods/interactives/international-methodology/global-attitudes-survey/all-country/2022/)

3. This human-composed haiku or a bouquet of [artificial intelligence-generated limericks](https://www.gnod.com/search/ai#q=write%20a%20limerick-style%20poem%20about%20the%20chapter_title)

```{r}
# sock puppet pundit
# throws 'ssue, cites pew-laced news, sighs
# "unbutton your eyes!"
```
~~~


~~~{download_and_import_block}

1. Register for a Pew Research Center at https://www.pewresearch.org/profile/registration/.

2. Choose `DOWNLOAD THIS DATASET` at https://www.pewresearch.org/global/dataset/spring-2022-survey-data/.

3. Download the SPSS dataset `Pew-Research-Center-Global-Attitudes-Spring-2022-Survey-Data.zip` dated 04/03/2023:

```{r eval = FALSE , results = "hide" }
library(haven)

chapter_tag_fn <- file.path( path.expand( "~" ) , "Pew Research Center Global Attitudes Spring 2022 Dataset.sav" )

chapter_tag_tbl <- read_sav( chapter_tag_fn )

chapter_tag_tbl <- zap_labels( chapter_tag_tbl )

chapter_tag_df <- data.frame( chapter_tag_tbl )

names( chapter_tag_df ) <- tolower( names( chapter_tag_df ) )
```
~~~





~~~{analysis_examples_survey_design}

Collapse the country-specific cluster and strata columns into a single cluster and a single stratum variable:
```{r eval = FALSE , results = "hide" }
# add the source variable name to each column
# for( this_variable in grep( "^psu_|^stratum_" , names( chapter_tag_df ) , value = TRUE ) ){
	# chapter_tag_df[ !is.na( chapter_tag_df[ , this_variable ] ) , this_variable ] <-
		# paste( this_variable , chapter_tag_df[ !is.na( chapter_tag_df[ , this_variable ] ) , this_variable ] )
# }

# create the constructed psu and strata variables from among the non-missing country-specific columns
chapter_tag_df[ , 'psu_constructed' ] <-
	apply(
		chapter_tag_df[ , grep( "^psu_" , names( chapter_tag_df ) ) ] , 
		1 ,
		function( w ) w[ which.min( is.na( w ) ) ]
	)
	
chapter_tag_df[ , 'stratum_constructed' ] <-
	apply(
		chapter_tag_df[ , grep( "^stratum_" , names( chapter_tag_df ) ) ] , 
		1 ,
		function( w ) w[ which.min( is.na( w ) ) ]
	)

# for countries without clustering and strata variables, use the country identifier
chapter_tag_df[ is.na( chapter_tag_df[ , 'psu_constructed' ] ) , 'psu_constructed' ] <- 0
	# chapter_tag_df[ is.na( chapter_tag_df[ , 'psu_constructed' ] ) , 'country' ]

chapter_tag_df[ is.na( chapter_tag_df[ , 'stratum_constructed' ] ) , 'stratum_constructed' ] <- 0
	# chapter_tag_df[ is.na( chapter_tag_df[ , 'stratum_constructed' ] ) , 'country' ]
```



This design generalizes to residents of the United States that were living in the community in 1996 (wave 3) and also still alive (and participating in the survey) as of 2020 (wave 15):

```{r eval = FALSE , results = "hide" }
options( survey.lonely.psu = "adjust" )

library(survey)

chapter_tag_design <- 
	svydesign(
		id = ~ psu_constructed ,
		strata = ~ interaction( country , stratum_constructed ) ,
		data = chapter_tag_df ,
		weights = ~ weight , 
		nest = TRUE
	)
```

~~~

~~~{variable_recoding_block}
chapter_tag_design <- 
	update( 
		chapter_tag_design , 

		one = 1 ,
		
		working_in_1996 = r3work ,

		working_in_2020 = r15work ,

		marital_stat_1996 =
			factor( r3mstat , levels = 1:8 , labels =
				c( "Married" , "Married, spouse absent" ,
				"Partnered" , "Separated" , "Divorced" ,
				"Separated/divorced" , "Widowed" ,
				"Never married" ) ) ,
				
		marital_stat_2020 =
			factor( r15mstat , levels = 1:8 , labels =
				c( "Married" , "Married, spouse absent" ,
				"Partnered" , "Separated" , "Divorced" ,
				"Separated/divorced" , "Widowed" ,
				"Never married" ) )
	)
~~~


group_by_variable: marital_stat_1996

categorical_variable: marital_stat_2020
categorical_narm: , na.rm = TRUE

linear_variable: h15ahous
linear_variable_description: value of primary residence in 2020
linear_narm: , na.rm = TRUE

ratio_estimation_numerator: h4ahous
ratio_estimation_denominator: h15ahous
ratio_narm: , na.rm = TRUE

subset_definition: working_in_1996 == 1

binary_variable: working_in_2020
binary_narm: , na.rm = TRUE


needs_srvyr_block: yes

~~~{replication_example_block}
## Replication Example {-}


This example matches statistics and standard errors to four digits from the Pew Research Center's [How to analyze Pew Research Center survey data in R](
https://medium.com/pew-research-center-decoded/how-to-analyze-pew-research-center-survey-data-in-r-f326df360713):


1. Choose `DOWNLOAD THIS DATASET` at https://www.pewresearch.org/politics/dataset/april-2017-political-survey/.

2. Download the SPSS dataset `Apr17-public-4.3-update.zip` dated 12/29/2017:

```{r eval = FALSE , results = "hide" }
political_survey_2017_fn <- file.path( path.expand( "~" ) , "Apr17 public.sav" )

political_survey_2017_tbl <- read_sav( political_survey_2017_fn )

political_survey_2017_df <- data.frame( political_survey_2017_tbl )

names( political_survey_2017_df ) <- tolower( names( political_survey_2017_df ) )
```

Construct a complex sample survey design:

```{r eval = FALSE , results = "hide" }
political_survey_2017_design <-
	svydesign(
		~ 0 ,
		data = political_survey_2017_df ,
		weights = ~ weight
	)
```

Add new columns to the data set:
```{r eval = FALSE , results = "hide" }	
political_survey_2017_design <-
	update(
		political_survey_2017_design ,
		q1 = factor( q1 , levels = c( 1 , 2 , 9 ) , labels = c( 'Approve' , 'Disapprove' , 'DK/RF' ) )
	)
```

Reproduce the coefficients and standard errors shown under `Estimating frequencies with survey weights`:

```{r eval = FALSE , results = "hide" }
result <- svymean( ~ q1 , political_survey_2017_design , na.rm = TRUE )

stopifnot( round( coef( result ) , 4 ) == c( 0.3940 , 0.5424 , 0.0636 ) )
stopifnot( round( SE( result ) , 4 ) == c( 0.0144 , 0.0147 , 0.0078 ) )
```
~~~

