chapter_title: National Immunization Survey

needs_actions_build_status_line: yes

~~~{dataset_introduction}
The National Immunization Survey tracks childhood vaccination rates at the state-level.
~~~

table_structure: * One table with one row per sampled toddler.

generalizable_population: * A complex sample survey designed to generalize to children aged 19-35 months in the United States.

publication_period: * Released annually since 1995.

administrative_organization: * Administered by the [Centers for Disease Control and Prevention](http://www.cdc.gov/).





~~~{reading_block}
Please skim before you begin:

1.

2.

3. This poem

```{r}
# 
# 
# 
```
~~~


~~~{download_and_import_block}

Run the import code provided by the CDC:
```{r eval = FALSE }
library(Hmisc)

tf <- tempfile()

dat_url <- "https://ftp.cdc.gov/pub/Vaccines_NIS/NISPUF21.DAT"

download.file( dat_url , tf , mode = 'wb' )


r_input_url <- "https://ftp.cdc.gov/pub/Vaccines_NIS/NISPUF21.R"

r_input_lines <- readLines( r_input_url )

# do not let the script do the save()
r_input_lines <- gsub( "^save\\(" , "# save(" , r_input_lines )

# redirect flat file to tf
r_input_lines <- gsub( '\\"path\\-to\\-file\\/(.*)\\.DAT\\"' , "tf" , r_input_lines )

eval( parse( text = r_input_lines ) )

chapter_tag_df <- NISPUF21

names( chapter_tag_df ) <- tolower( names( chapter_tag_df ) )

chapter_tag_df[ , 'one' ] <- 1
```
~~~





~~~{analysis_examples_survey_design}
```{r messages = FALSE , eval = FALSE }
options( survey.lonely.psu = "adjust" )

library(survey)

chapter_tag_design <- 
	svydesign(
		id = ~ seqnumhh , 
		strata = ~ stratum , 
		weights = ~ provwt_c , 
		data = subset( chapter_tag_df , provwt_c > 0 ) 
	)
```
~~~

~~~{variable_recoding_block}
chapter_tag_design <- 
	
	update( 
		
		chapter_tag_design , 
		
		dtap_3p =

			as.numeric(

				( p_numdah >= 3 ) |
				( p_numdhi >= 3 ) |
				( p_numdih >= 3 ) |
				( p_numdta >= 3 ) |
				( p_numdtp >= 3 )

			) ,
		
		dtap_4p =

			as.numeric(

				( p_numdah >= 4 ) |
				( p_numdhi >= 4 ) |
				( p_numdih >= 4 ) |
				( p_numdta >= 4 ) |
				( p_numdtp >= 4 )

			)
			
	)
~~~

group_by_variable: state
group_by_variable_description: state of residence

categorical_variable: sex
categorical_variable_description: sex (1=female, 2=male)
categorical_narm: , na.rm = TRUE

linear_variable: p_nuhepx
linear_variable_description: number of hepatitis b-only shots by 36 months
linear_narm: , na.rm = TRUE

ratio_estimation_numerator: childnm
ratio_estimation_denominator: bf_endr06
ratio_narm: , na.rm = TRUE

subset_definition: p_utdpol == 1
subset_definition_description: toddlers up to date on polio shots

binary_variable: dtap_3p
binary_variable_description: received 3+ DTaP recommendation

~~~{intermission_block}
<center>https://en.wikipedia.org/wiki/Lorem_ipsum</center>
~~~

needs_srvyr_block: yes

~~~{replication_example_block}
## Replication Example {-}

https://www.cdc.gov/vaccines/imz-managers/nis/downloads/NIS-PUF21-DUG.pdf#page=35

```{r eval = FALSE , results = "hide" }

results <-
	svyby( 
		~ p_utd431h314_rout_s , 
		~ raceethk , 
		chapter_tag_design , 
		svymean
	)

stopifnot( round( results[ "HISPANIC" , "p_utd431h314_rout_sUTD" , ] , 3 ) == .711 )
stopifnot( round( results[ "NON-HISPANIC WHITE ONLY" , "p_utd431h314_rout_sUTD" , ] , 3 ) == .742 )
stopifnot( round( results[ "NON-HISPANIC BLACK ONLY" , "p_utd431h314_rout_sUTD" , ] , 3 ) == .647 )
stopifnot( round( results[ "HISPANIC" , "se.p_utd431h314_rout_sUTD" , ] , 3 ) == .015 )
stopifnot( round( results[ "NON-HISPANIC WHITE ONLY" , "se.p_utd431h314_rout_sUTD" , ] , 3 ) == .009 )
stopifnot( round( results[ "NON-HISPANIC BLACK ONLY" , "se.p_utd431h314_rout_sUTD" , ] , 3 ) == .022 )
```

~~~





