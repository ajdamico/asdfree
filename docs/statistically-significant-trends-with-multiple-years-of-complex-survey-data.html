<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Statistically Significant Trends with Multiple Years of Complex Survey Data | Analyze Survey Data for Free</title>
  <meta name="description" content="Statistically Significant Trends with Multiple Years of Complex Survey Data | Analyze Survey Data for Free" />
  <meta name="generator" content="bookdown 0.31 and GitBook 2.6.7" />

  <meta property="og:title" content="Statistically Significant Trends with Multiple Years of Complex Survey Data | Analyze Survey Data for Free" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="ajdamico/asdfree" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Statistically Significant Trends with Multiple Years of Complex Survey Data | Analyze Survey Data for Free" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="structural-equation-models-sem-with-complex-survey-data.html"/>
<link rel="next" href="youth-risk-behavior-surveillance-system-yrbss.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Analyze Survey Data for Free</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Public Microdata, Easy to Type Website</a></li>
<li class="chapter" data-level="" data-path="american-community-survey-acs.html"><a href="american-community-survey-acs.html"><i class="fa fa-check"></i>American Community Survey (ACS)</a>
<ul>
<li class="chapter" data-level="" data-path="american-community-survey-acs.html"><a href="american-community-survey-acs.html#download-import-preparation"><i class="fa fa-check"></i>Download, Import, Preparation</a></li>
<li class="chapter" data-level="" data-path="american-community-survey-acs.html"><a href="american-community-survey-acs.html#analysis-examples-with-the-survey-library"><i class="fa fa-check"></i>Analysis Examples with the <code>survey</code> library  </a>
<ul>
<li class="chapter" data-level="" data-path="american-community-survey-acs.html"><a href="american-community-survey-acs.html#variable-recoding"><i class="fa fa-check"></i>Variable Recoding</a></li>
<li class="chapter" data-level="" data-path="american-community-survey-acs.html"><a href="american-community-survey-acs.html#unweighted-counts"><i class="fa fa-check"></i>Unweighted Counts</a></li>
<li class="chapter" data-level="" data-path="american-community-survey-acs.html"><a href="american-community-survey-acs.html#weighted-counts"><i class="fa fa-check"></i>Weighted Counts</a></li>
<li class="chapter" data-level="" data-path="american-community-survey-acs.html"><a href="american-community-survey-acs.html#descriptive-statistics"><i class="fa fa-check"></i>Descriptive Statistics</a></li>
<li class="chapter" data-level="" data-path="american-community-survey-acs.html"><a href="american-community-survey-acs.html#subsetting"><i class="fa fa-check"></i>Subsetting</a></li>
<li class="chapter" data-level="" data-path="american-community-survey-acs.html"><a href="american-community-survey-acs.html#measures-of-uncertainty"><i class="fa fa-check"></i>Measures of Uncertainty</a></li>
<li class="chapter" data-level="" data-path="american-community-survey-acs.html"><a href="american-community-survey-acs.html#regression-models-and-tests-of-association"><i class="fa fa-check"></i>Regression Models and Tests of Association</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="american-community-survey-acs.html"><a href="american-community-survey-acs.html#poverty-and-inequality-estimation-with-convey"><i class="fa fa-check"></i>Poverty and Inequality Estimation with <code>convey</code>  </a></li>
<li class="chapter" data-level="" data-path="american-community-survey-acs.html"><a href="american-community-survey-acs.html#analysis-examples-with-srvyr"><i class="fa fa-check"></i>Analysis Examples with <code>srvyr</code>  </a></li>
<li class="chapter" data-level="" data-path="american-community-survey-acs.html"><a href="american-community-survey-acs.html#replication-example"><i class="fa fa-check"></i>Replication Example</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="balancing-respondent-confidentiality-with-variance-estimation-precision.html"><a href="balancing-respondent-confidentiality-with-variance-estimation-precision.html"><i class="fa fa-check"></i>Balancing Respondent Confidentiality with Variance Estimation Precision</a></li>
<li class="chapter" data-level="" data-path="structural-equation-models-sem-with-complex-survey-data.html"><a href="structural-equation-models-sem-with-complex-survey-data.html"><i class="fa fa-check"></i>Structural Equation Models (SEM) with Complex Survey Data</a>
<ul>
<li class="chapter" data-level="" data-path="structural-equation-models-sem-with-complex-survey-data.html"><a href="structural-equation-models-sem-with-complex-survey-data.html#load-the-2008-wave-of-the-european-social-survey-german-and-spanish-microdata"><i class="fa fa-check"></i>Load the 2008 Wave of the European Social Survey German and Spanish Microdata</a></li>
<li class="chapter" data-level="" data-path="structural-equation-models-sem-with-complex-survey-data.html"><a href="structural-equation-models-sem-with-complex-survey-data.html#two-factor-cfa-of-attitudes-toward-the-welfare-state"><i class="fa fa-check"></i>Two-factor CFA of attitudes toward the welfare state</a></li>
<li class="chapter" data-level="" data-path="structural-equation-models-sem-with-complex-survey-data.html"><a href="structural-equation-models-sem-with-complex-survey-data.html#invariance-testing-on-schwarz-human-values-while-accounting-for-the-survey-design."><i class="fa fa-check"></i>Invariance testing on Schwarz human values while accounting for the survey design.</a></li>
<li class="chapter" data-level="" data-path="structural-equation-models-sem-with-complex-survey-data.html"><a href="structural-equation-models-sem-with-complex-survey-data.html#an-example-with-a-latent-variable-regression"><i class="fa fa-check"></i>An example with a Latent Variable Regression</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html"><i class="fa fa-check"></i>Statistically Significant Trends with Multiple Years of Complex Survey Data</a>
<ul>
<li class="chapter" data-level="" data-path="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#data-importation"><i class="fa fa-check"></i>Data Importation</a></li>
<li class="chapter" data-level="" data-path="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#load-required-packages-options-external-functions"><i class="fa fa-check"></i>Load Required Packages, Options, External Functions</a></li>
<li class="chapter" data-level="" data-path="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#harmonize-and-stack-multiple-years-of-survey-data"><i class="fa fa-check"></i>Harmonize and Stack Multiple Years of Survey Data</a></li>
<li class="chapter" data-level="" data-path="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#construct-a-multi-year-stacked-complex-survey-design-object"><i class="fa fa-check"></i>Construct a Multi-Year Stacked Complex Survey Design Object</a></li>
<li class="chapter" data-level="" data-path="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#review-the-unadjusted-results"><i class="fa fa-check"></i>Review the unadjusted results</a></li>
<li class="chapter" data-level="" data-path="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#calculate-the-number-of-joinpoints-needed"><i class="fa fa-check"></i>Calculate the Number of Joinpoints Needed</a></li>
<li class="chapter" data-level="" data-path="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#calculate-the-adjusted-prevalence-and-predicted-marginals"><i class="fa fa-check"></i>Calculate the Adjusted Prevalence and Predicted Marginals</a></li>
<li class="chapter" data-level="" data-path="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#identify-the-breakpointchangepoint"><i class="fa fa-check"></i>Identify the Breakpoint/Changepoint</a></li>
<li class="chapter" data-level="" data-path="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#make-statistically-defensible-statements-about-linear-trends-with-complex-survey-data"><i class="fa fa-check"></i>Make statistically defensible statements about linear trends with complex survey data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="youth-risk-behavior-surveillance-system-yrbss.html"><a href="youth-risk-behavior-surveillance-system-yrbss.html"><i class="fa fa-check"></i>Youth Risk Behavior Surveillance System (YRBSS)</a>
<ul>
<li class="chapter" data-level="" data-path="youth-risk-behavior-surveillance-system-yrbss.html"><a href="youth-risk-behavior-surveillance-system-yrbss.html#download-import-preparation-1"><i class="fa fa-check"></i>Download, Import, Preparation</a></li>
<li class="chapter" data-level="" data-path="youth-risk-behavior-surveillance-system-yrbss.html"><a href="youth-risk-behavior-surveillance-system-yrbss.html#analysis-examples-with-the-survey-library-1"><i class="fa fa-check"></i>Analysis Examples with the <code>survey</code> library  </a>
<ul>
<li class="chapter" data-level="" data-path="youth-risk-behavior-surveillance-system-yrbss.html"><a href="youth-risk-behavior-surveillance-system-yrbss.html#variable-recoding-1"><i class="fa fa-check"></i>Variable Recoding</a></li>
<li class="chapter" data-level="" data-path="youth-risk-behavior-surveillance-system-yrbss.html"><a href="youth-risk-behavior-surveillance-system-yrbss.html#unweighted-counts-1"><i class="fa fa-check"></i>Unweighted Counts</a></li>
<li class="chapter" data-level="" data-path="youth-risk-behavior-surveillance-system-yrbss.html"><a href="youth-risk-behavior-surveillance-system-yrbss.html#weighted-counts-1"><i class="fa fa-check"></i>Weighted Counts</a></li>
<li class="chapter" data-level="" data-path="youth-risk-behavior-surveillance-system-yrbss.html"><a href="youth-risk-behavior-surveillance-system-yrbss.html#descriptive-statistics-1"><i class="fa fa-check"></i>Descriptive Statistics</a></li>
<li class="chapter" data-level="" data-path="youth-risk-behavior-surveillance-system-yrbss.html"><a href="youth-risk-behavior-surveillance-system-yrbss.html#subsetting-1"><i class="fa fa-check"></i>Subsetting</a></li>
<li class="chapter" data-level="" data-path="youth-risk-behavior-surveillance-system-yrbss.html"><a href="youth-risk-behavior-surveillance-system-yrbss.html#measures-of-uncertainty-1"><i class="fa fa-check"></i>Measures of Uncertainty</a></li>
<li class="chapter" data-level="" data-path="youth-risk-behavior-surveillance-system-yrbss.html"><a href="youth-risk-behavior-surveillance-system-yrbss.html#regression-models-and-tests-of-association-1"><i class="fa fa-check"></i>Regression Models and Tests of Association</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="youth-risk-behavior-surveillance-system-yrbss.html"><a href="youth-risk-behavior-surveillance-system-yrbss.html#analysis-examples-with-srvyr-1"><i class="fa fa-check"></i>Analysis Examples with <code>srvyr</code>  </a></li>
<li class="chapter" data-level="" data-path="youth-risk-behavior-surveillance-system-yrbss.html"><a href="youth-risk-behavior-surveillance-system-yrbss.html#replication-example-1"><i class="fa fa-check"></i>Replication Example</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Analyze Survey Data for Free</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="statistically-significant-trends-with-multiple-years-of-complex-survey-data" class="section level1 unnumbered hasAnchor">
<h1>Statistically Significant Trends with Multiple Years of Complex Survey Data<a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#statistically-significant-trends-with-multiple-years-of-complex-survey-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><a href="https://github.com/asdfree/trendy/actions"><img src="https://github.com/asdfree/trendy/actions/workflows/r.yml/badge.svg" alt="Github Actions Badge"></a></p>
<p><em>Contributed by Thomas Yokota &lt;<a href="mailto:thomasyokota@gmail.com" class="email">thomasyokota@gmail.com</a>&gt;</em></p>
<p>Palermo Professor <a href="mailto:vito.muggeo@unipa.it">Vito Muggeo</a> wrote the joinpoint analysis section of the code below to demonstrate that <a href="https://cran.r-project.org/web/packages/segmented/index.html">the <code>segmented</code> package</a> eliminates the need for <a href="http://surveillance.cancer.gov/joinpoint/download.html">external (registration-only, windows-only, workflow-disrupting) software</a>. <a href="http://r-survey.r-forge.r-project.org/survey/"><code>survey</code> package</a> creator and professor <a href="mailto:t.lumley@auckland.ac.nz">Dr. Thomas Lumley</a> wrote <a href="https://cran.r-project.org/web/packages/survey/NEWS">the <code>svypredmeans</code> function</a> to replicate SUDAAN’s <code>PREDMARG</code> command and match the CDC to the decimal. <a href="mailto:rxl1@cdc.gov">Dr. Richard Lowry, M.D.</a> at the Centers for Disease Control &amp; Prevention wrote <a href="http://www.cdc.gov/healthyyouth/yrbs/pdf/yrbs_conducting_trend_analyses.pdf">the original linear trend analysis</a> and then answered our infinite questions. Thanks to everyone.</p>
<p>The purpose of this analysis is to make statistically valid statements such as, <em>“there was a significant linear decrease in the prevalence of high school aged americans who have ever smoked a cigarette across the period 1999-2011”</em> with complex sample survey data.</p>
<p>This step-by-step walkthrough exactly reproduces the statistics presented in the <a href="http://www.cdc.gov/healthyyouth/yrbs/pdf/yrbs_conducting_trend_analyses.pdf">Center for Disease Control &amp; Prevention’s (CDC) linear trend analysis</a>, using free and open source methods rather than proprietary or restricted software.</p>
<p>The example below displays only linearized designs (created with <a href="http://r-survey.r-forge.r-project.org/survey/html/svydesign.html">the <code>svydesign</code> function</a>). For more detail about how to reproduce this analysis with a replicate-weighted design (created with <a href="http://r-survey.r-forge.r-project.org/survey/html/svrepdesign.html">the <code>svrepdesign</code> function</a>), see the methods note below section #4.</p>
<div id="data-importation" class="section level2 unnumbered hasAnchor">
<h2>Data Importation<a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#data-importation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Prior to running this analysis script, the Youth Risk Behavioral Surveillance System (YRBSS) 1991-2011 single-year files must all be loaded as R data files (.rda) on your local machine. Running the download automation script will create the appropriate files. If you need assistance with the data-loading step, first review <a href="http://www.asdfree.com/search/label/youth%20risk%20behavior%20surveillance%20system%20%28yrbss%29">the main YRBSS blog post</a>.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>( <span class="at">survey.lonely.psu =</span> <span class="st">&quot;adjust&quot;</span> )</span>
<span id="cb59-2"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb59-4"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lodown)</span>
<span id="cb59-6"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="co"># retrieve a listing of all available extracts for the youth risk behavioral surveillance system</span></span>
<span id="cb59-8"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb59-8" aria-hidden="true" tabindex="-1"></a>yrbss_cat <span class="ot">&lt;-</span> <span class="fu">get_catalog</span>( <span class="st">&quot;yrbss&quot;</span> , <span class="at">output_dir =</span> <span class="fu">file.path</span>( <span class="fu">path.expand</span>( <span class="st">&quot;~&quot;</span> ) , <span class="st">&quot;YRBSS&quot;</span> ) )</span>
<span id="cb59-9"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb59-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-10"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="co"># limit the catalog to only years 2005-2015</span></span>
<span id="cb59-11"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb59-11" aria-hidden="true" tabindex="-1"></a>yrbss_cat <span class="ot">&lt;-</span> <span class="fu">subset</span>( yrbss_cat , year <span class="sc">%in%</span> <span class="fu">seq</span>( <span class="dv">2005</span> , <span class="dv">2015</span> , <span class="dv">2</span> ) )</span>
<span id="cb59-12"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb59-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-13"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb59-13" aria-hidden="true" tabindex="-1"></a><span class="co"># download the yrbss microdata</span></span>
<span id="cb59-14"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="fu">lodown</span>( <span class="st">&quot;yrbss&quot;</span> , yrbss_cat )</span></code></pre></div>
</div>
<div id="load-required-packages-options-external-functions" class="section level2 unnumbered hasAnchor">
<h2>Load Required Packages, Options, External Functions<a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#load-required-packages-options-external-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages( c( &quot;segmented&quot; , &quot;ggplot2&quot; , &quot;ggthemes&quot; , &quot;texreg&quot; ) )</span></span>
<span id="cb60-2"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Muggeo V. (2008) Segmented: an R package to fit regression models with broken-line relationships. R News, 8, 1: 20-25.</span></span>
<span id="cb60-4"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(segmented)</span>
<span id="cb60-5"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb60-7"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb60-8"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(texreg)</span></code></pre></div>
</div>
<div id="harmonize-and-stack-multiple-years-of-survey-data" class="section level2 unnumbered hasAnchor">
<h2>Harmonize and Stack Multiple Years of Survey Data<a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#harmonize-and-stack-multiple-years-of-survey-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This step is clearly dataset-specific. In order for your trend analysis to work, you’ll need to figure out how to align the variables from multiple years of data into a trendable, stacked <code>data.frame</code> object.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># initiate an empty `y` object</span></span>
<span id="cb61-2"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb61-3"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co"># loop through each year of YRBSS microdata</span></span>
<span id="cb61-5"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( year <span class="cf">in</span> <span class="fu">seq</span>( <span class="dv">2005</span> , <span class="dv">2015</span> , <span class="dv">2</span> ) ){</span>
<span id="cb61-6"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># load the current year</span></span>
<span id="cb61-8"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-8" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">readRDS</span>( </span>
<span id="cb61-9"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">file.path</span>( <span class="fu">path.expand</span>( <span class="st">&quot;~&quot;</span> ) , <span class="st">&quot;YRBSS&quot;</span> , </span>
<span id="cb61-10"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste0</span>( year , <span class="st">&quot; main.rds&quot;</span> ) ) )</span>
<span id="cb61-11"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-12"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># tack on a `year` column</span></span>
<span id="cb61-13"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-13" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>year <span class="ot">&lt;-</span> year</span>
<span id="cb61-14"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-15"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>( year <span class="sc">==</span> <span class="dv">2005</span> ) x<span class="sc">$</span>raceeth <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb61-16"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-17"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># stack that year of data alongside the others,</span></span>
<span id="cb61-18"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ignoring mis-matching columns</span></span>
<span id="cb61-19"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-19" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> <span class="fu">rbind</span>( x[ <span class="fu">c</span>( <span class="st">&quot;q2&quot;</span> , <span class="st">&quot;q3&quot;</span> , <span class="st">&quot;q4&quot;</span> , <span class="st">&quot;qn10&quot;</span> , <span class="st">&quot;year&quot;</span> , <span class="st">&quot;psu&quot;</span> , <span class="st">&quot;stratum&quot;</span> , <span class="st">&quot;weight&quot;</span> , <span class="st">&quot;raceeth&quot;</span> ) ] , y )</span>
<span id="cb61-20"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-21"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># clear the single-year of microdata from RAM</span></span>
<span id="cb61-22"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>( x )</span>
<span id="cb61-23"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-24"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-25"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-26"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-27"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-27" aria-hidden="true" tabindex="-1"></a><span class="co"># convert every column to numeric type</span></span>
<span id="cb61-28"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-28" aria-hidden="true" tabindex="-1"></a>y[ , ] <span class="ot">&lt;-</span> <span class="fu">sapply</span>( y[ , ] , as.numeric )</span>
<span id="cb61-29"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-30"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-30" aria-hidden="true" tabindex="-1"></a><span class="co"># construct year-specific recodes so that</span></span>
<span id="cb61-31"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-31" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;ever smoked a cigarette&quot; // grade // sex // race-ethnicity align across years</span></span>
<span id="cb61-32"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-32" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span></span>
<span id="cb61-33"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transform</span>(</span>
<span id="cb61-34"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-34" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb61-35"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-35" aria-hidden="true" tabindex="-1"></a>        y ,</span>
<span id="cb61-36"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb61-37"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">rode_with_drunk_driver =</span> qn10 ,</span>
<span id="cb61-38"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-38" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb61-39"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">raceeth =</span> </span>
<span id="cb61-40"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-40" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb61-41"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-41" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ifelse</span>( year <span class="sc">==</span> <span class="dv">2005</span> ,</span>
<span id="cb61-42"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-42" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ifelse</span>( q4 <span class="sc">%in%</span> <span class="dv">6</span> , <span class="dv">1</span> ,</span>
<span id="cb61-43"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-43" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ifelse</span>( q4 <span class="sc">%in%</span> <span class="dv">3</span> , <span class="dv">2</span> ,</span>
<span id="cb61-44"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-44" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ifelse</span>( q4 <span class="sc">%in%</span> <span class="fu">c</span>( <span class="dv">4</span> , <span class="dv">7</span> ) , <span class="dv">3</span> ,</span>
<span id="cb61-45"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-45" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ifelse</span>( q4 <span class="sc">%in%</span> <span class="fu">c</span>( <span class="dv">1</span> , <span class="dv">2</span> , <span class="dv">5</span> , <span class="dv">8</span> ) , <span class="dv">4</span> , <span class="cn">NA</span> ) ) ) ) ,</span>
<span id="cb61-46"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-46" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb61-47"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-47" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ifelse</span>( raceeth <span class="sc">%in%</span> <span class="dv">5</span> , <span class="dv">1</span> ,</span>
<span id="cb61-48"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-48" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ifelse</span>( raceeth <span class="sc">%in%</span> <span class="dv">3</span> , <span class="dv">2</span> ,</span>
<span id="cb61-49"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-49" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ifelse</span>( raceeth <span class="sc">%in%</span> <span class="fu">c</span>( <span class="dv">6</span> , <span class="dv">7</span> ) , <span class="dv">3</span> ,</span>
<span id="cb61-50"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-50" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ifelse</span>( raceeth <span class="sc">%in%</span> <span class="fu">c</span>( <span class="dv">1</span> , <span class="dv">2</span> , <span class="dv">4</span> , <span class="dv">8</span> ) , <span class="dv">4</span> , <span class="cn">NA</span> ) ) ) ) ) ,</span>
<span id="cb61-51"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-51" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb61-52"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-52" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb61-53"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-53" aria-hidden="true" tabindex="-1"></a>        <span class="at">grade =</span> <span class="fu">ifelse</span>( q3 <span class="sc">==</span> <span class="dv">5</span> , <span class="cn">NA</span> , <span class="fu">as.numeric</span>( q3 ) ) ,</span>
<span id="cb61-54"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-54" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb61-55"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">sex =</span> <span class="fu">ifelse</span>( q2 <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span> , q2 , <span class="cn">NA</span> )</span>
<span id="cb61-56"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-56" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb61-57"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-57" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb61-58"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-59"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-60"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-60" aria-hidden="true" tabindex="-1"></a><span class="co"># again remove unnecessary variables, keeping only the complex sample survey design columns</span></span>
<span id="cb61-61"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-61" aria-hidden="true" tabindex="-1"></a><span class="co"># plus independent/dependent variables to be used in the regression analyses</span></span>
<span id="cb61-62"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-62" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> y[ <span class="fu">c</span>( <span class="st">&quot;year&quot;</span> , <span class="st">&quot;psu&quot;</span> , <span class="st">&quot;stratum&quot;</span> , <span class="st">&quot;weight&quot;</span> , <span class="st">&quot;rode_with_drunk_driver&quot;</span> , <span class="st">&quot;raceeth&quot;</span> , <span class="st">&quot;sex&quot;</span> , <span class="st">&quot;grade&quot;</span> ) ]</span>
<span id="cb61-63"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-64"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-64" aria-hidden="true" tabindex="-1"></a><span class="co"># set female to the reference group</span></span>
<span id="cb61-65"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-65" aria-hidden="true" tabindex="-1"></a>y<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">relevel</span>( <span class="fu">factor</span>( y<span class="sc">$</span>sex ) , <span class="at">ref =</span> <span class="st">&quot;2&quot;</span> )</span>
<span id="cb61-66"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-67"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-67" aria-hidden="true" tabindex="-1"></a><span class="co"># set ever smoked=yes // white // 9th graders as the reference groups</span></span>
<span id="cb61-68"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb61-68" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( i <span class="cf">in</span> <span class="fu">c</span>( <span class="st">&#39;rode_with_drunk_driver&#39;</span> , <span class="st">&#39;raceeth&#39;</span> , <span class="st">&#39;grade&#39;</span> ) ) y[ , i ] <span class="ot">&lt;-</span> <span class="fu">relevel</span>( <span class="fu">factor</span>( y[ , i ] ) , <span class="at">ref =</span> <span class="st">&quot;1&quot;</span> )</span></code></pre></div>
</div>
<div id="construct-a-multi-year-stacked-complex-survey-design-object" class="section level2 unnumbered hasAnchor">
<h2>Construct a Multi-Year Stacked Complex Survey Design Object<a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#construct-a-multi-year-stacked-complex-survey-design-object" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Before constructing a multi-year stacked design object, check out <code>?contr.poly</code> - this function implements polynomials used in our trend analysis during step #6. For more detail on this subject, see <a href="https://www.google.com/search?q=The+polynomials+we+have+used+as+predictors+to+this+point+are+natural+polynomials%2C+generated+from+the+linear+predictor+by+centering+and+the+powering+the+linear+predictor.&amp;ie=utf-8&amp;oe=utf-8">page 216 of Applied Multiple Regression/Correlation Analysis for the Behavioral Sciences</a> By Jacob Cohen, Patricia Cohen, Stephen G. West, Leona S. Aiken <em>“The polynomials we have used as predictors to this point are natural polynomials, generated from the linear predictor by centering and the powering the linear predictor.”</em></p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract a linear contrast vector of length eleven,</span></span>
<span id="cb62-2"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="co"># because we have eleven distinct years of yrbss data `seq( 2005 , 2015 , 2 )`</span></span>
<span id="cb62-3"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-3" aria-hidden="true" tabindex="-1"></a>c6l <span class="ot">&lt;-</span> <span class="fu">contr.poly</span>( <span class="dv">6</span> )[ , <span class="dv">1</span> ]</span>
<span id="cb62-4"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="co"># also extract a quadratic (squared) contrast vector</span></span>
<span id="cb62-6"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-6" aria-hidden="true" tabindex="-1"></a>c6q <span class="ot">&lt;-</span> <span class="fu">contr.poly</span>( <span class="dv">6</span> )[ , <span class="dv">2</span> ]</span>
<span id="cb62-7"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-8"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="co"># just in case, extract a cubic contrast vector</span></span>
<span id="cb62-9"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-9" aria-hidden="true" tabindex="-1"></a>c6c <span class="ot">&lt;-</span> <span class="fu">contr.poly</span>( <span class="dv">6</span> )[ , <span class="dv">3</span> ]</span>
<span id="cb62-10"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-11"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="co"># for each record in the data set, tack on the linear, quadratic, and cubic contrast value</span></span>
<span id="cb62-12"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="co"># these contrast values will serve as replacement for the linear `year` variable in any regression.</span></span>
<span id="cb62-13"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-14"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-14" aria-hidden="true" tabindex="-1"></a><span class="co"># year^1 term (linear)</span></span>
<span id="cb62-15"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-15" aria-hidden="true" tabindex="-1"></a>y<span class="sc">$</span>t6l <span class="ot">&lt;-</span> c6l[ <span class="fu">match</span>( y<span class="sc">$</span>year , <span class="fu">seq</span>( <span class="dv">2005</span> , <span class="dv">2015</span> , <span class="dv">2</span> ) ) ]</span>
<span id="cb62-16"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-17"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-17" aria-hidden="true" tabindex="-1"></a><span class="co"># year^2 term (quadratic)</span></span>
<span id="cb62-18"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-18" aria-hidden="true" tabindex="-1"></a>y<span class="sc">$</span>t6q <span class="ot">&lt;-</span> c6q[ <span class="fu">match</span>( y<span class="sc">$</span>year , <span class="fu">seq</span>( <span class="dv">2005</span> , <span class="dv">2015</span> , <span class="dv">2</span> ) ) ]</span>
<span id="cb62-19"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-20"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-20" aria-hidden="true" tabindex="-1"></a><span class="co"># year^3 term (cubic)</span></span>
<span id="cb62-21"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-21" aria-hidden="true" tabindex="-1"></a>y<span class="sc">$</span>t6c <span class="ot">&lt;-</span> c6c[ <span class="fu">match</span>( y<span class="sc">$</span>year , <span class="fu">seq</span>( <span class="dv">2005</span> , <span class="dv">2015</span> , <span class="dv">2</span> ) ) ]</span>
<span id="cb62-22"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-23"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-23" aria-hidden="true" tabindex="-1"></a><span class="co"># construct a complex sample survey design object</span></span>
<span id="cb62-24"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-24" aria-hidden="true" tabindex="-1"></a><span class="co"># stacking multiple years and accounting for `year` in the nested strata</span></span>
<span id="cb62-25"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-25" aria-hidden="true" tabindex="-1"></a>des <span class="ot">&lt;-</span> </span>
<span id="cb62-26"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">svydesign</span>(</span>
<span id="cb62-27"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">id =</span> <span class="sc">~</span>psu , </span>
<span id="cb62-28"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">strata =</span> <span class="sc">~</span><span class="fu">interaction</span>( stratum , year ) ,</span>
<span id="cb62-29"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> y , </span>
<span id="cb62-30"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">weights =</span> <span class="sc">~</span>weight , </span>
<span id="cb62-31"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">nest =</span> <span class="cn">TRUE</span></span>
<span id="cb62-32"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb62-32" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<p>Now we’ve got a multi-year stack of complex survey designs with linear, quadratic, and cubic contrast values appended. If you’d like more detail about stacking multiple years of complex survey data, review <a href="http://www.cdc.gov/healthyyouth/yrbs/pdf/yrbs_combining_data.pdf">the CDC’s manual</a> on the topic. Hopefully we won’t need anything beyond cubic, but let’s find out.</p>
<p><strong>Methods note</strong> about how to stack replication designs: This is only relevant if you are trying to create a <code>des</code> like the object above but just have replicate weights and do not have the clustering information (psu). It is straightforward to construct a replication design <em>from</em> a linearized design (see <a href="http://r-survey.r-forge.r-project.org/survey/html/as.svrepdesign.html"><code>as.svrepdesign</code></a>). However, <a href="http://www.asdfree.com/2014/09/how-to-provide-variance-calculation-on.html">for privacy reasons, going in the opposite direction is much more challenging</a>. Therefore, you’ll need to do some dataset-specific homework on how to best <em>stack</em> multiple years of a replicate-weighted design you construct a multiple-year-stacked survey design like the object above.</p>
<p>If you’d like to experiment with how the two approaches differ (theoretically, very little), these publicly-available survey data sets include both replicate weights and, separately, clustering information:</p>
<p><a href="http://www.asdfree.com/search/label/medical%20expenditure%20panel%20survey%20%28meps%29">Medical Expenditure Panel Survey</a><br />
<a href="http://www.asdfree.com/search/label/national%20health%20and%20nutrition%20examination%20survey%20%28nhanes%29">National Health and Nutrition Examination Survey</a><br />
<a href="http://www.asdfree.com/search/label/consumer%20expenditure%20survey%20%28ce%29">Consumer Expenditure Survey</a></p>
<p>In most cases, omitting the <code>year</code> variable from the <code>strata = ~interaction( stratum , year )</code> construction of <code>des</code> above will make your standard errors larger (conservative) -&gt; ergo -&gt; you can probably just <code>rbind( file_with_repweights_year_one , file_with_repweights_year_two , ... )</code> so long as the survey design has not changed in structure over the time period that you are analyzing. Once you have the rbound replicate weights object for every year, you could just construct one huge multi-year <code>svrepdesign</code> object. Make sure you include <code>scale</code>, <code>rscales</code>, <code>rho</code>, and whatever else the <code>svrepdesign()</code> call asks for. If you are worried you missed something, check <code>attributes( your_single_year_replication_design_object )</code>. This solution is likely to be a decent approach in most cases.</p>
<p>If you need to be very conservative with your computation of trend statistical significance, you might attempt to re-construct fake clusters for yourself using a regression. Search for “malicious” in <a href="https://github.com/ajdamico/asdfree/blob/master/Confidentiality/how%20to%20create%20de-identified%20replicate%20weights.R">this confidentiality explanation document</a>. The purpose here, though, isn’t to identify individual respondents in the dataset, it’s to get a variable like <code>psu</code> above that gives you reasonable standard errors. Look for the object <code>your.replicate.weights</code> in that script. You could reconstruct a fake psu for each record in your data set with something as easy as..</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # fake_psu should be a one-record-per-person vector object</span></span>
<span id="cb63-2"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="co"># # that can immediately be appended onto your data set.</span></span>
<span id="cb63-3"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fake_psu &lt;- kmeans( your.replicate.weights , 20 )</span></span></code></pre></div>
<p>..where 20 is the (completely made up) number of clusters x strata. Hopefully the methodology documents (or the people who wrote them) will at least tell you how many clusters there were in the original sample, even if the clusters themselves were not disclosed. At the point you’ve made fake clusters, they will surely be worse than the real clusters (i.e. conservative standard errors) and you can construct a multiple-year survey design with:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># des &lt;- svydesign( id = ~ your_fake_psus , strata = ~ year , data = y , weights = ~ weight , nest = TRUE )</span></span></code></pre></div>
<p>This approach will probably be conservative probably.</p>
</div>
<div id="review-the-unadjusted-results" class="section level2 unnumbered hasAnchor">
<h2>Review the unadjusted results<a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#review-the-unadjusted-results" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here’s the change over time for smoking prevalence among youth. Unadjusted prevalence rates (Figure 1) suggest a significant change in smoking prevalence.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># immediately remove records with missing smoking status</span></span>
<span id="cb65-2"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb65-2" aria-hidden="true" tabindex="-1"></a>des_ns <span class="ot">&lt;-</span> <span class="fu">subset</span>( des , <span class="sc">!</span><span class="fu">is.na</span>( rode_with_drunk_driver ) )</span>
<span id="cb65-3"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate unadjusted, un-anythinged &quot;ever smoked&quot; rates by year</span></span>
<span id="cb65-5"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co"># note that this reproduces the unadjusted &quot;ever smoked&quot; statistics at the top of</span></span>
<span id="cb65-6"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co"># pdf page 6 of http://www.cdc.gov/healthyyouth/yrbs/pdf/yrbs_conducting_trend_analyses.pdf</span></span>
<span id="cb65-7"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb65-7" aria-hidden="true" tabindex="-1"></a>unadjusted <span class="ot">&lt;-</span> <span class="fu">svyby</span>( <span class="sc">~</span> rode_with_drunk_driver , <span class="sc">~</span> year , svymean , <span class="at">design =</span> des_ns , <span class="at">vartype =</span> <span class="fu">c</span>( <span class="st">&#39;ci&#39;</span> , <span class="st">&#39;se&#39;</span> ) )</span>
<span id="cb65-8"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb65-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-9"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="co"># coerce that result into a `data.frame` object</span></span>
<span id="cb65-10"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb65-10" aria-hidden="true" tabindex="-1"></a>my_plot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( unadjusted )</span>
<span id="cb65-11"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb65-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-12"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the unadjusted decline in smoking</span></span>
<span id="cb65-13"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb65-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>( my_plot , <span class="fu">aes</span>( <span class="at">x =</span> year, <span class="at">y =</span> rode_with_drunk_driver1 ) ) <span class="sc">+</span></span>
<span id="cb65-14"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb65-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb65-15"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb65-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>( <span class="fu">aes</span>( <span class="at">ymax =</span> ci_u.rode_with_drunk_driver1 , <span class="at">ymin =</span> ci_l.rode_with_drunk_driver1 ) , <span class="at">width =</span> .<span class="dv">2</span> ) <span class="sc">+</span></span>
<span id="cb65-16"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb65-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb65-17"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb65-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte</span>() <span class="sc">+</span></span>
<span id="cb65-18"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb65-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>( <span class="st">&quot;Figure 1. Unadjusted smoking prevalence 1999-2011&quot;</span> ) <span class="sc">+</span></span>
<span id="cb65-19"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb65-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>( <span class="at">plot.title =</span> <span class="fu">element_text</span>( <span class="at">size =</span> <span class="dv">9</span> , <span class="at">face =</span> <span class="st">&quot;bold&quot;</span> ) )</span></code></pre></div>
</div>
<div id="calculate-the-number-of-joinpoints-needed" class="section level2 unnumbered hasAnchor">
<h2>Calculate the Number of Joinpoints Needed<a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#calculate-the-number-of-joinpoints-needed" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Using the orthogonal coefficients (linear, quadratic, cubic terms) that we previously added to our <code>data.frame</code> object before constructing the multi-year stacked survey design, let’s now determine how many joinpoints will be needed for a trend analysis.</p>
<p>Epidemiological models typically control for possible confounding variables such as sex and race, so let’s add them in with the linear, cubic, and quadratic year terms.</p>
<p>Calculate the “ever smoked” binomial regression, adjusted by sex, age, race-ethnicity, and a linear year contrast.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb66-1" aria-hidden="true" tabindex="-1"></a>linyear <span class="ot">&lt;-</span> </span>
<span id="cb66-2"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb66-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">svyglm</span>(</span>
<span id="cb66-3"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb66-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">I</span>( rode_with_drunk_driver <span class="sc">==</span> <span class="dv">1</span> ) <span class="sc">~</span> sex <span class="sc">+</span> raceeth <span class="sc">+</span> grade <span class="sc">+</span> t6l , </span>
<span id="cb66-4"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb66-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">design =</span> <span class="fu">subset</span>( des_ns , rode_with_drunk_driver <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span> ) , </span>
<span id="cb66-5"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb66-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">family =</span> quasibinomial</span>
<span id="cb66-6"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb66-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb66-7"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb66-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-8"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>( linyear )</span></code></pre></div>
<p>The linear year-contrast variable <code>t11l</code> is hugely significant here. Therefore, there is probably going to be some sort of trend. A linear trend does not need joinpoints. Not one, just zero joinpoints. If the linear term were the only significant term (out of linear, quadratic, cubic, etc.), then we would not need to calculate a joinpoint. In other words, we would not need to figure out where to best break our time trend into two, three, or even four segments.</p>
<p>The linear trend is significant, so we should keep going.</p>
<hr />
<p><strong>Interpretation note</strong> about segments of time: The linear term <code>t11l</code> was significant, so we probably have a significant linear trend somewhere to report. Now we need to figure out when that significant linear trend started and when it ended. It might be semantically true that there was a significant linear decrease in high school aged smoking over the entire period of our data 1991-2011; however, it’s inexact, unrefined to give up after only detecting a linear trend. The purpose of the following few steps is really to <em>cordon off</em> different time points from one another. As you’ll see later, there actually was not any detectable decrease from 1991-1999. The entirety of the decline in smoking occurred over the period from 1999-2011. So these next (methodologically tricky) steps serve to provide you and your audience with a more careful statement of statistical significance. It’s not technically wrong to conclude that smoking declined over the period of 1991-2011, it’s just verbose.</p>
<p>Think of it as the difference between “humans first walked on the moon in the sixties” and “humans first walked on the moon in 1969” - both statements are correct, but the latter exhibits greater scientific precision.</p>
<hr />
<p>Calculate the “ever smoked” binomial regression, adjusted by sex, age, race-ethnicity, and both linear and quadratic year contrasts. Notice the addition of <code>t11q</code>.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb67-1" aria-hidden="true" tabindex="-1"></a>quadyear <span class="ot">&lt;-</span></span>
<span id="cb67-2"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb67-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">svyglm</span>(</span>
<span id="cb67-3"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb67-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">I</span>( rode_with_drunk_driver <span class="sc">==</span> <span class="dv">1</span> ) <span class="sc">~</span> sex <span class="sc">+</span> raceeth <span class="sc">+</span> grade <span class="sc">+</span> t6l <span class="sc">+</span> t6q , </span>
<span id="cb67-4"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb67-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">design =</span> <span class="fu">subset</span>( des_ns , rode_with_drunk_driver <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span> ) , </span>
<span id="cb67-5"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb67-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">family =</span> quasibinomial </span>
<span id="cb67-6"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb67-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb67-7"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb67-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-8"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>( quadyear )</span></code></pre></div>
<p>The linear year-contrast variable is hugely significant here but the quadratic year-contrast variable is also significant. Therefore, we should use joinpoint software for this analysis. A significant quadratic trend needs one joinpoint.</p>
<p>Since both linear and quadratic terms are significant, we should move ahead and test whether the cubic term is also significant.</p>
<p>Calculate the “ever smoked” binomial regression, adjusted by sex, age, race-ethnicity, and linear, quadratic, and cubic year contrasts. Notice the addition of <code>t11c</code>.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb68-1" aria-hidden="true" tabindex="-1"></a>cubyear <span class="ot">&lt;-</span></span>
<span id="cb68-2"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb68-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">svyglm</span>(</span>
<span id="cb68-3"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb68-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">I</span>( rode_with_drunk_driver <span class="sc">==</span> <span class="dv">1</span> ) <span class="sc">~</span> sex <span class="sc">+</span> raceeth <span class="sc">+</span> grade <span class="sc">+</span> t6l <span class="sc">+</span> t6q <span class="sc">+</span> t6c , </span>
<span id="cb68-4"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb68-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">design =</span> <span class="fu">subset</span>( des_ns , rode_with_drunk_driver <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span> ) , </span>
<span id="cb68-5"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb68-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">family =</span> quasibinomial </span>
<span id="cb68-6"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb68-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb68-7"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb68-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb68-8"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>( cubyear )</span></code></pre></div>
<p>The cubic year-contrast term is <em>not</em> significant in this model. Therefore, we should stop testing the shape of this line. In other words, we can stop at a quadratic trend and <em>do not</em> need a cubic trend. That means we can stop at a single joinpoint. Remember: a linear trend requires zero joinpoints, a quadratic trend typically requires one joinpoint, a cubic trend usually requires two, and on and on.</p>
<p>Note: if the cubic trend <em>were</em> significant, then we would increase the number of joinpoints to <em>two</em> instead of <em>one</em> but since the cubic term is not significant, we should stop with the previous regression. If we keep getting significant trends, we ought to continue testing whether higher terms continue to be significant. So <code>year^4</code> requires three joinpoints, <code>year^5</code> requires four joinpoints, and so on. If these terms continued to be significant, we would need to return to step #4 and add additional <code>year^n</code> terms to the model.</p>
Just for coherence’s sake, let’s assemble all of these results into a single table where you can see the linear, quadratic, and cubic models side-by-side. The quadratic trend best describes the relationship between prevalence of smoking and change-over-time. The decision to test beyond linear trends, however, is a decision for the individual researcher to make. It is a decision that can be driven by theoretical issues, existing literature, or the availability of data.
<center>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">htmlreg</span>(<span class="fu">list</span>(linyear , quadyear , cubyear), <span class="at">doctype =</span> F, <span class="at">html.tag =</span> F, <span class="at">inline.css =</span> T, </span>
<span id="cb69-2"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb69-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">head.tag =</span> F, <span class="at">body.tag =</span> F, <span class="at">center =</span> F, <span class="at">single.row =</span> T, <span class="at">caption =</span> <span class="st">&quot;Table 1. Testing for linear trends&quot;</span>)</span></code></pre></div>
</center>
</div>
<div id="calculate-the-adjusted-prevalence-and-predicted-marginals" class="section level2 unnumbered hasAnchor">
<h2>Calculate the Adjusted Prevalence and Predicted Marginals<a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#calculate-the-adjusted-prevalence-and-predicted-marginals" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>First, calculate the survey-year-independent predictor effects and store these results into a separate object.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb70-1" aria-hidden="true" tabindex="-1"></a>marginals <span class="ot">&lt;-</span> </span>
<span id="cb70-2"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb70-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">svyglm</span>(</span>
<span id="cb70-3"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb70-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">formula =</span> <span class="fu">I</span>( rode_with_drunk_driver <span class="sc">==</span> <span class="dv">1</span> ) <span class="sc">~</span> sex <span class="sc">+</span> raceeth <span class="sc">+</span> grade ,</span>
<span id="cb70-4"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb70-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">design =</span> des_ns , </span>
<span id="cb70-5"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb70-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">family =</span> quasibinomial</span>
<span id="cb70-6"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb70-6" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<p>Second, run these marginals through the <code>svypredmeans</code> function written by Dr. Thomas Lumley. For any archaeology fans out there, this function emulates the <code>PREDMARG</code> statement in the ancient language of SUDAAN.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb71-1" aria-hidden="true" tabindex="-1"></a>( means_for_joinpoint <span class="ot">&lt;-</span> <span class="fu">svypredmeans</span>( marginals , <span class="sc">~</span><span class="fu">factor</span>( year ) ) )</span></code></pre></div>
<p>Finally, clean up these results a bit in preparation for a joinpoint analysis.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># coerce the results to a data.frame object</span></span>
<span id="cb72-2"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb72-2" aria-hidden="true" tabindex="-1"></a>means_for_joinpoint <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>( means_for_joinpoint )</span>
<span id="cb72-3"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the row names as the survey year</span></span>
<span id="cb72-5"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb72-5" aria-hidden="true" tabindex="-1"></a>means_for_joinpoint<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>( <span class="fu">rownames</span>( means_for_joinpoint ) )</span>
<span id="cb72-6"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb72-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-7"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="co"># must be sorted, just in case it&#39;s not already</span></span>
<span id="cb72-8"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb72-8" aria-hidden="true" tabindex="-1"></a>means_for_joinpoint <span class="ot">&lt;-</span> means_for_joinpoint[ <span class="fu">order</span>( means_for_joinpoint<span class="sc">$</span>year ) , ]</span>
<span id="cb72-9"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb72-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-10"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="co"># rename columns so they do not conflict with variables in memory</span></span>
<span id="cb72-11"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>( means_for_joinpoint ) <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="st">&#39;mean&#39;</span> , <span class="st">&#39;se&#39;</span> , <span class="st">&#39;yr&#39;</span> )</span>
<span id="cb72-12"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="co"># the above line is only because the ?segmented function (used below)</span></span>
<span id="cb72-13"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="co"># does not work if an object of the same name is also in memory.</span></span>
<span id="cb72-14"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb72-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-15"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb72-15" aria-hidden="true" tabindex="-1"></a>another_plot <span class="ot">&lt;-</span> means_for_joinpoint</span>
<span id="cb72-16"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb72-16" aria-hidden="true" tabindex="-1"></a>another_plot<span class="sc">$</span>ci_l.mean <span class="ot">&lt;-</span> another_plot<span class="sc">$</span>mean <span class="sc">-</span> (<span class="fl">1.96</span> <span class="sc">*</span> another_plot<span class="sc">$</span>se)</span>
<span id="cb72-17"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb72-17" aria-hidden="true" tabindex="-1"></a>another_plot<span class="sc">$</span>ci_u.mean <span class="ot">&lt;-</span> another_plot<span class="sc">$</span>mean <span class="sc">+</span> (<span class="fl">1.96</span> <span class="sc">*</span> another_plot<span class="sc">$</span>se)</span>
<span id="cb72-18"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb72-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-19"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb72-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(another_plot, <span class="fu">aes</span>(<span class="at">x =</span> yr, <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb72-20"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb72-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb72-21"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb72-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymax =</span> ci_u.mean, <span class="at">ymin =</span> ci_l.mean), <span class="at">width=</span>.<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb72-22"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb72-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb72-23"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb72-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte</span>() <span class="sc">+</span></span>
<span id="cb72-24"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb72-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Figure 2. Adjusted smoking prevalence 1999-2011&quot;</span>) <span class="sc">+</span></span>
<span id="cb72-25"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb72-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">9</span>, <span class="at">face=</span><span class="st">&quot;bold&quot;</span>))</span></code></pre></div>
</div>
<div id="identify-the-breakpointchangepoint" class="section level2 unnumbered hasAnchor">
<h2>Identify the Breakpoint/Changepoint<a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#identify-the-breakpointchangepoint" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The original CDC analysis recommended some <a href="http://surveillance.cancer.gov/joinpoint/">external software from the National Cancer Institute</a>, which only runs on selected platforms. Dr. Vito Muggeo wrote this within-R solution using his <a href="https://cran.r-project.org/web/packages/segmented/index.html">segmented</a> package available on CRAN. Let’s take a look at how confident we are in the value at each adjusted timepoint. Carrying out a trend analysis requires creating new weights to fit a piecewise linear regression. Figure 3 shows the relationship between variance at each datum and weighting. Larger circles display greater uncertainty and therefore lower weight.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>( means_for_joinpoint , <span class="fu">aes</span>( <span class="at">x =</span> yr , <span class="at">y =</span> mean ) ) <span class="sc">+</span></span>
<span id="cb73-2"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb73-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>( <span class="fu">aes</span>( <span class="at">size =</span> se ) ) <span class="sc">+</span></span>
<span id="cb73-3"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb73-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_tufte</span>() <span class="sc">+</span></span>
<span id="cb73-4"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb73-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>( <span class="st">&quot;Figure 3. Standard Error at each timepoint</span><span class="sc">\n</span><span class="st">(smaller dots indicate greater confidence in each adjusted value)&quot;</span></span>
<span id="cb73-5"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb73-5" aria-hidden="true" tabindex="-1"></a>) </span></code></pre></div>
<p>First, create that weight variable.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb74-1" aria-hidden="true" tabindex="-1"></a>means_for_joinpoint<span class="sc">$</span>wgt <span class="ot">&lt;-</span> <span class="fu">with</span>( means_for_joinpoint, ( mean <span class="sc">/</span> se ) <span class="sc">^</span> <span class="dv">2</span> ) </span></code></pre></div>
<p>Second, fit a piecewise linear regression.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate the &#39;starting&#39; linear model with the usual &quot;lm&quot; function using the log values and the weights.</span></span>
<span id="cb75-2"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb75-2" aria-hidden="true" tabindex="-1"></a>o <span class="ot">&lt;-</span> <span class="fu">lm</span>( <span class="fu">log</span>( mean ) <span class="sc">~</span> yr , <span class="at">weights =</span> wgt , <span class="at">data =</span> means_for_joinpoint )</span></code></pre></div>
<p>Now that the regression has been structured correctly, estimate the year that our complex survey trend should be broken into two segments (the changepoint/breakpoint/joinpoint).</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the segmented() function uses a random process in its algorithm.</span></span>
<span id="cb76-2"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="co"># setting the random seed ensures reproducibility</span></span>
<span id="cb76-3"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>( <span class="dv">2015</span> )</span>
<span id="cb76-4"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb76-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-5"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="co"># add a segmented variable (`yr` in this example) with 1 breakpoint</span></span>
<span id="cb76-6"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb76-6" aria-hidden="true" tabindex="-1"></a>os <span class="ot">&lt;-</span> <span class="fu">segmented</span>( o , <span class="sc">~</span>yr )</span>
<span id="cb76-7"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb76-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-8"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="co"># `os` is now a `segmented` object, which means it includes information on the fitted model,</span></span>
<span id="cb76-9"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="co"># such as parameter estimates, standard errors, residuals.</span></span>
<span id="cb76-10"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb76-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>( os )</span></code></pre></div>
<p>See the <code>Estimated Break-Point(s)</code> in that result? That’s the critical number from this joinpoint analysis.</p>
<p>Note that the above number is not an integer! The <a href="https://cran.r-project.org/web/packages/segmented/index.html">R <code>segmented</code> package</a> uses an iterative procedure (described in the article below) and therefore between-year solutions are returned. The joinpoint software implements two estimating algorithms: the grid-search and the Hudson algorithm. For more detail about these methods, see <a href="http://onlinelibrary.wiley.com/doi/10.1002/sim.1545/abstract">Muggeo V. (2003) Estimating regression models with unknown break-points. Statistics in Medicine, 22: 3055-3071.</a>.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># figuring out the breakpoint year was the purpose of this joinpoint analysis.</span></span>
<span id="cb77-2"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb77-2" aria-hidden="true" tabindex="-1"></a>( your_breakpoint <span class="ot">&lt;-</span> <span class="fu">round</span>( <span class="fu">as.vector</span>( os<span class="sc">$</span>psi[, <span class="st">&quot;Est.&quot;</span> ] ) ) )</span>
<span id="cb77-3"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="co"># so.  that&#39;s a joinpoint.  that&#39;s where the two line segments join.  okay?</span></span>
<span id="cb77-4"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="co"># obtain the annual percent change (APC=) estimates for each time point</span></span>
<span id="cb77-6"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="fu">slope</span>( os , <span class="at">APC =</span> <span class="cn">TRUE</span> )</span></code></pre></div>
<p>The returned CIs for the annual percent change (APC) may be different from the ones returned by <a href="surveillance.cancer.gov/joinpoint/">NCI’s Joinpoint Software</a>; for further details, check out <a href="http://onlinelibrary.wiley.com/doi/10.1002/sim.3850/abstract">Muggeo V. (2010) A Comment on `Estimating average annual per cent change in trend analysis’ by Clegg et al., Statistics in Medicine; 28, 3670-3682. Statistics in Medicine, 29, 1958-1960.</a></p>
<p>This analysis returned similar results to the NCI’s Joinpoint Regression Program by estimating a changepoint at <code>year=1999</code> - and, more precisely, that the start of that decreasing trend in smoking prevalence happened at an APC of -3.92 percent. That is, <code>slope2</code> from the output above.</p>
</div>
<div id="make-statistically-defensible-statements-about-linear-trends-with-complex-survey-data" class="section level2 unnumbered hasAnchor">
<h2>Make statistically defensible statements about linear trends with complex survey data<a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#make-statistically-defensible-statements-about-linear-trends-with-complex-survey-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>After identifying the change point for smoking prevalence, we can create two regression models (one for each time segment). (If we had two joinpoints, we would need three regression models.) The first model covers the years leading up to (and including) the changepoint (i.e., 1991 to 1999). The second model includes the years from the changepoint forward (i.e., 1999 to 2011). So start with 1991, 1993, 1995, 1997, 1999, the five year-points before (and including 1999).</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate a five-timepoint linear contrast vector</span></span>
<span id="cb78-2"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb78-2" aria-hidden="true" tabindex="-1"></a>c3l <span class="ot">&lt;-</span> <span class="fu">contr.poly</span>( <span class="dv">3</span> )[ , <span class="dv">1</span> ]</span>
<span id="cb78-3"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="co"># tack the five-timepoint linear contrast vectors onto the current survey design object</span></span>
<span id="cb78-5"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb78-5" aria-hidden="true" tabindex="-1"></a>des_ns <span class="ot">&lt;-</span> <span class="fu">update</span>( des_ns , <span class="at">t3l =</span> c3l[ <span class="fu">match</span>( year , <span class="fu">seq</span>( <span class="dv">2005</span> , <span class="dv">2009</span> , <span class="dv">2</span> ) ) ] )</span>
<span id="cb78-6"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb78-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-7"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb78-7" aria-hidden="true" tabindex="-1"></a>pre_91_99 <span class="ot">&lt;-</span></span>
<span id="cb78-8"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb78-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">svyglm</span>(</span>
<span id="cb78-9"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb78-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">I</span>( rode_with_drunk_driver <span class="sc">==</span> <span class="dv">1</span> ) <span class="sc">~</span> sex <span class="sc">+</span> raceeth <span class="sc">+</span> grade <span class="sc">+</span> t3l ,</span>
<span id="cb78-10"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb78-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">design =</span> <span class="fu">subset</span>( des_ns , rode_with_drunk_driver <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span> <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> <span class="dv">2009</span> ) , </span>
<span id="cb78-11"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb78-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">family =</span> quasibinomial</span>
<span id="cb78-12"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb78-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb78-13"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb78-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-14"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb78-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>( pre_91_99 )</span></code></pre></div>
<p>Reproduce the sentence on <a href="http://www.cdc.gov/healthyyouth/yrbs/pdf/yrbs_conducting_trend_analyses.pdf#page=6">pdf page 6 of the original document</a>. <strong>In this example, T5L_L had a p-value=0.52261 and beta=0.03704. Therefore, there was “no significant change in the prevalence of ever smoking a cigarette during 1991-1999.”</strong></p>
<p>Then move on to 1999, 2001, 2003, 2005, 2007, 2009, and 2011, the seven year-points after (and including 1999).</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate a seven-timepoint linear contrast vector</span></span>
<span id="cb79-2"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb79-2" aria-hidden="true" tabindex="-1"></a>c4l <span class="ot">&lt;-</span> <span class="fu">contr.poly</span>( <span class="dv">4</span> )[ , <span class="dv">1</span> ]</span>
<span id="cb79-3"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="co"># tack the seven-timepoint linear contrast vectors onto the current survey design object</span></span>
<span id="cb79-5"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb79-5" aria-hidden="true" tabindex="-1"></a>des_ns <span class="ot">&lt;-</span> <span class="fu">update</span>( des_ns , <span class="at">t4l =</span> c4l[ <span class="fu">match</span>( year , <span class="fu">seq</span>( <span class="dv">2009</span> , <span class="dv">2015</span> , <span class="dv">2</span> ) ) ] )</span>
<span id="cb79-6"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb79-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-7"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb79-7" aria-hidden="true" tabindex="-1"></a>post_99_11 <span class="ot">&lt;-</span></span>
<span id="cb79-8"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb79-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">svyglm</span>(</span>
<span id="cb79-9"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb79-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">I</span>( rode_with_drunk_driver <span class="sc">==</span> <span class="dv">1</span> ) <span class="sc">~</span> sex <span class="sc">+</span> raceeth <span class="sc">+</span> grade <span class="sc">+</span> t4l ,</span>
<span id="cb79-10"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb79-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">design =</span> <span class="fu">subset</span>( des_ns , rode_with_drunk_driver <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span> <span class="sc">&amp;</span> year <span class="sc">&gt;=</span> <span class="dv">2009</span> ) , </span>
<span id="cb79-11"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb79-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">family =</span> quasibinomial</span>
<span id="cb79-12"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb79-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb79-13"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb79-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb79-14"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb79-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>( post_99_11 )</span></code></pre></div>
<p>Reproduce the sentence on <a href="http://www.cdc.gov/healthyyouth/yrbs/pdf/yrbs_conducting_trend_analyses.pdf#page=6">pdf page 6 of the original document</a>. <strong>In this example, T7L_R had a p-value&lt;0.0001 and beta=-0.99165. Therefore, there was a “significant linear decrease in the prevalence of ever smoking a cigarette during 1999-2011.”</strong></p>
<p>Note also that the 1999-2011 time period saw a linear decrease, which supports the APC estimate in step #8. Here’s everything displayed as a single coherent table.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">htmlreg</span>(<span class="fu">list</span>(pre_91_99, post_99_11), <span class="at">doctype =</span> F, <span class="at">html.tag =</span> F, <span class="at">inline.css =</span> T, </span>
<span id="cb80-2"><a href="statistically-significant-trends-with-multiple-years-of-complex-survey-data.html#cb80-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">head.tag =</span> F, <span class="at">body.tag =</span> F, <span class="at">center =</span> F, <span class="at">single.row =</span> T, <span class="at">caption =</span> <span class="st">&quot;Table 2. Linear trends pre-post changepoint&quot;</span>)</span></code></pre></div>
<p><em>This analysis may complement qualitative evaluation on prevalence changes observed from surveillance data by providing quantitative evidence, such as when a change point occurred. This analysis does not explain why or how changes in trends occur.</em></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="structural-equation-models-sem-with-complex-survey-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="youth-risk-behavior-surveillance-system-yrbss.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ajdamico/asdfree/edit/master/trendy.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
