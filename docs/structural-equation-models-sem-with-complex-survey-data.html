<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Structural Equation Models (SEM) with Complex Survey Data | Analyze Survey Data for Free</title>
  <meta name="description" content="Structural Equation Models (SEM) with Complex Survey Data | Analyze Survey Data for Free" />
  <meta name="generator" content="bookdown 0.31 and GitBook 2.6.7" />

  <meta property="og:title" content="Structural Equation Models (SEM) with Complex Survey Data | Analyze Survey Data for Free" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="ajdamico/asdfree" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Structural Equation Models (SEM) with Complex Survey Data | Analyze Survey Data for Free" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="american-community-survey-acs.html"/>
<link rel="next" href="trend-analysis-across-multiple-years-of-complex-survey-data.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Analyze Survey Data for Free</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Public Microdata, Easy to Type Website</a></li>
<li class="chapter" data-level="" data-path="american-community-survey-acs.html"><a href="american-community-survey-acs.html"><i class="fa fa-check"></i>American Community Survey (ACS)</a>
<ul>
<li class="chapter" data-level="" data-path="american-community-survey-acs.html"><a href="american-community-survey-acs.html#download-import-preparation"><i class="fa fa-check"></i>Download, Import, Preparation</a></li>
<li class="chapter" data-level="" data-path="american-community-survey-acs.html"><a href="american-community-survey-acs.html#analysis-examples-with-the-survey-library"><i class="fa fa-check"></i>Analysis Examples with the <code>survey</code> library  </a>
<ul>
<li class="chapter" data-level="" data-path="american-community-survey-acs.html"><a href="american-community-survey-acs.html#variable-recoding"><i class="fa fa-check"></i>Variable Recoding</a></li>
<li class="chapter" data-level="" data-path="american-community-survey-acs.html"><a href="american-community-survey-acs.html#unweighted-counts"><i class="fa fa-check"></i>Unweighted Counts</a></li>
<li class="chapter" data-level="" data-path="american-community-survey-acs.html"><a href="american-community-survey-acs.html#weighted-counts"><i class="fa fa-check"></i>Weighted Counts</a></li>
<li class="chapter" data-level="" data-path="american-community-survey-acs.html"><a href="american-community-survey-acs.html#descriptive-statistics"><i class="fa fa-check"></i>Descriptive Statistics</a></li>
<li class="chapter" data-level="" data-path="american-community-survey-acs.html"><a href="american-community-survey-acs.html#subsetting"><i class="fa fa-check"></i>Subsetting</a></li>
<li class="chapter" data-level="" data-path="american-community-survey-acs.html"><a href="american-community-survey-acs.html#measures-of-uncertainty"><i class="fa fa-check"></i>Measures of Uncertainty</a></li>
<li class="chapter" data-level="" data-path="american-community-survey-acs.html"><a href="american-community-survey-acs.html#regression-models-and-tests-of-association"><i class="fa fa-check"></i>Regression Models and Tests of Association</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="american-community-survey-acs.html"><a href="american-community-survey-acs.html#intermish"><i class="fa fa-check"></i>Intermish</a></li>
<li class="chapter" data-level="" data-path="american-community-survey-acs.html"><a href="american-community-survey-acs.html#poverty-and-inequality-estimation-with-convey"><i class="fa fa-check"></i>Poverty and Inequality Estimation with <code>convey</code>  </a></li>
<li class="chapter" data-level="" data-path="american-community-survey-acs.html"><a href="american-community-survey-acs.html#analysis-examples-with-srvyr"><i class="fa fa-check"></i>Analysis Examples with <code>srvyr</code>  </a></li>
<li class="chapter" data-level="" data-path="american-community-survey-acs.html"><a href="american-community-survey-acs.html#technical-documentation-replication-example"><i class="fa fa-check"></i>Technical Documentation Replication Example</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="structural-equation-models-sem-with-complex-survey-data.html"><a href="structural-equation-models-sem-with-complex-survey-data.html"><i class="fa fa-check"></i>Structural Equation Models (SEM) with Complex Survey Data</a>
<ul>
<li class="chapter" data-level="" data-path="structural-equation-models-sem-with-complex-survey-data.html"><a href="structural-equation-models-sem-with-complex-survey-data.html#load-the-2008-wave-of-the-european-social-survey-german-and-spanish-microdata"><i class="fa fa-check"></i>Load the 2008 Wave of the European Social Survey German and Spanish Microdata</a></li>
<li class="chapter" data-level="" data-path="structural-equation-models-sem-with-complex-survey-data.html"><a href="structural-equation-models-sem-with-complex-survey-data.html#two-factor-cfa-of-attitudes-toward-the-welfare-state"><i class="fa fa-check"></i>Two-factor CFA of attitudes toward the welfare state</a></li>
<li class="chapter" data-level="" data-path="structural-equation-models-sem-with-complex-survey-data.html"><a href="structural-equation-models-sem-with-complex-survey-data.html#invariance-testing-on-schwarz-human-values-while-accounting-for-the-survey-design."><i class="fa fa-check"></i>Invariance testing on Schwarz human values while accounting for the survey design.</a></li>
<li class="chapter" data-level="" data-path="structural-equation-models-sem-with-complex-survey-data.html"><a href="structural-equation-models-sem-with-complex-survey-data.html#an-example-with-a-latent-variable-regression"><i class="fa fa-check"></i>An example with a Latent Variable Regression</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="trend-analysis-across-multiple-years-of-complex-survey-data.html"><a href="trend-analysis-across-multiple-years-of-complex-survey-data.html"><i class="fa fa-check"></i>Trend Analysis Across Multiple Years of Complex Survey Data</a>
<ul>
<li class="chapter" data-level="" data-path="trend-analysis-across-multiple-years-of-complex-survey-data.html"><a href="trend-analysis-across-multiple-years-of-complex-survey-data.html#download-import-preparation-1"><i class="fa fa-check"></i>Download, Import, Preparation</a></li>
<li class="chapter" data-level="" data-path="trend-analysis-across-multiple-years-of-complex-survey-data.html"><a href="trend-analysis-across-multiple-years-of-complex-survey-data.html#append-polynomials-to-each-year-of-data"><i class="fa fa-check"></i>Append Polynomials to Each Year of Data</a></li>
<li class="chapter" data-level="" data-path="trend-analysis-across-multiple-years-of-complex-survey-data.html"><a href="trend-analysis-across-multiple-years-of-complex-survey-data.html#analysis-examples-with-the-survey-library-1"><i class="fa fa-check"></i>Analysis Examples with the <code>survey</code> library  </a></li>
<li class="chapter" data-level="" data-path="trend-analysis-across-multiple-years-of-complex-survey-data.html"><a href="trend-analysis-across-multiple-years-of-complex-survey-data.html#calculate-the-number-of-joinpoints-needed"><i class="fa fa-check"></i>Calculate the Number of Joinpoints Needed</a></li>
<li class="chapter" data-level="" data-path="trend-analysis-across-multiple-years-of-complex-survey-data.html"><a href="trend-analysis-across-multiple-years-of-complex-survey-data.html#load-required-packages-options-external-functions"><i class="fa fa-check"></i>Load Required Packages, Options, External Functions</a></li>
<li class="chapter" data-level="" data-path="trend-analysis-across-multiple-years-of-complex-survey-data.html"><a href="trend-analysis-across-multiple-years-of-complex-survey-data.html#review-the-unadjusted-results"><i class="fa fa-check"></i>Review the unadjusted results</a></li>
<li class="chapter" data-level="" data-path="trend-analysis-across-multiple-years-of-complex-survey-data.html"><a href="trend-analysis-across-multiple-years-of-complex-survey-data.html#calculate-the-adjusted-prevalence-and-predicted-marginals"><i class="fa fa-check"></i>Calculate the Adjusted Prevalence and Predicted Marginals</a></li>
<li class="chapter" data-level="" data-path="trend-analysis-across-multiple-years-of-complex-survey-data.html"><a href="trend-analysis-across-multiple-years-of-complex-survey-data.html#identify-the-breakpointchangepoint"><i class="fa fa-check"></i>Identify the Breakpoint/Changepoint</a></li>
<li class="chapter" data-level="" data-path="trend-analysis-across-multiple-years-of-complex-survey-data.html"><a href="trend-analysis-across-multiple-years-of-complex-survey-data.html#make-statistically-defensible-statements-about-linear-trends-with-complex-survey-data"><i class="fa fa-check"></i>Make statistically defensible statements about linear trends with complex survey data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="youth-risk-behavior-surveillance-system-yrbss.html"><a href="youth-risk-behavior-surveillance-system-yrbss.html"><i class="fa fa-check"></i>Youth Risk Behavior Surveillance System (YRBSS)</a>
<ul>
<li class="chapter" data-level="" data-path="youth-risk-behavior-surveillance-system-yrbss.html"><a href="youth-risk-behavior-surveillance-system-yrbss.html#download-import-preparation-2"><i class="fa fa-check"></i>Download, Import, Preparation</a></li>
<li class="chapter" data-level="" data-path="youth-risk-behavior-surveillance-system-yrbss.html"><a href="youth-risk-behavior-surveillance-system-yrbss.html#analysis-examples-with-the-survey-library-2"><i class="fa fa-check"></i>Analysis Examples with the <code>survey</code> library  </a>
<ul>
<li class="chapter" data-level="" data-path="youth-risk-behavior-surveillance-system-yrbss.html"><a href="youth-risk-behavior-surveillance-system-yrbss.html#variable-recoding-1"><i class="fa fa-check"></i>Variable Recoding</a></li>
<li class="chapter" data-level="" data-path="youth-risk-behavior-surveillance-system-yrbss.html"><a href="youth-risk-behavior-surveillance-system-yrbss.html#unweighted-counts-1"><i class="fa fa-check"></i>Unweighted Counts</a></li>
<li class="chapter" data-level="" data-path="youth-risk-behavior-surveillance-system-yrbss.html"><a href="youth-risk-behavior-surveillance-system-yrbss.html#weighted-counts-1"><i class="fa fa-check"></i>Weighted Counts</a></li>
<li class="chapter" data-level="" data-path="youth-risk-behavior-surveillance-system-yrbss.html"><a href="youth-risk-behavior-surveillance-system-yrbss.html#descriptive-statistics-1"><i class="fa fa-check"></i>Descriptive Statistics</a></li>
<li class="chapter" data-level="" data-path="youth-risk-behavior-surveillance-system-yrbss.html"><a href="youth-risk-behavior-surveillance-system-yrbss.html#subsetting-1"><i class="fa fa-check"></i>Subsetting</a></li>
<li class="chapter" data-level="" data-path="youth-risk-behavior-surveillance-system-yrbss.html"><a href="youth-risk-behavior-surveillance-system-yrbss.html#measures-of-uncertainty-1"><i class="fa fa-check"></i>Measures of Uncertainty</a></li>
<li class="chapter" data-level="" data-path="youth-risk-behavior-surveillance-system-yrbss.html"><a href="youth-risk-behavior-surveillance-system-yrbss.html#regression-models-and-tests-of-association-1"><i class="fa fa-check"></i>Regression Models and Tests of Association</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="youth-risk-behavior-surveillance-system-yrbss.html"><a href="youth-risk-behavior-surveillance-system-yrbss.html#intermish-1"><i class="fa fa-check"></i>Intermish</a></li>
<li class="chapter" data-level="" data-path="youth-risk-behavior-surveillance-system-yrbss.html"><a href="youth-risk-behavior-surveillance-system-yrbss.html#analysis-examples-with-srvyr-1"><i class="fa fa-check"></i>Analysis Examples with <code>srvyr</code>  </a></li>
<li class="chapter" data-level="" data-path="youth-risk-behavior-surveillance-system-yrbss.html"><a href="youth-risk-behavior-surveillance-system-yrbss.html#technical-documentation-replication-example-1"><i class="fa fa-check"></i>Technical Documentation Replication Example</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Analyze Survey Data for Free</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="structural-equation-models-sem-with-complex-survey-data" class="section level1 unnumbered hasAnchor">
<h1>Structural Equation Models (SEM) with Complex Survey Data<a href="structural-equation-models-sem-with-complex-survey-data.html#structural-equation-models-sem-with-complex-survey-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><a href="https://github.com/asdfree/lavaanex/actions"><img src="https://github.com/asdfree/lavaanex/actions/workflows/r.yml/badge.svg" alt="Github Actions Badge"></a></p>
<p><em>Contributed by Dr. Daniel Oberski &lt;<a href="mailto:daniel.oberski@gmail.com" class="email">daniel.oberski@gmail.com</a>&gt;</em></p>
<p>The R <code>lavaan.survey</code> package by <a href="http://daob.nl">Dr. Daniel Oberski</a> fits structural equation models to complex survey microdata, described in his <a href="https://www.jstatsoft.org/article/view/v057i01">JSS article</a>.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>( <span class="st">&quot;lavaan.survey&quot;</span> , <span class="at">repos =</span> <span class="st">&quot;http://cran.rstudio.com/&quot;</span> )</span></code></pre></div>
<div id="load-the-2008-wave-of-the-european-social-survey-german-and-spanish-microdata" class="section level2 unnumbered hasAnchor">
<h2>Load the 2008 Wave of the European Social Survey German and Spanish Microdata<a href="structural-equation-models-sem-with-complex-survey-data.html#load-the-2008-wave-of-the-european-social-survey-german-and-spanish-microdata" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lodown)</span>
<span id="cb32-2"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lavaan.survey)  </span>
<span id="cb32-3"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>( <span class="at">survey.lonely.psu =</span> <span class="st">&quot;adjust&quot;</span> )</span>
<span id="cb32-4"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># retrieve a listing of all available extracts for the european social survey</span></span>
<span id="cb32-6"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb32-6" aria-hidden="true" tabindex="-1"></a>ess_cat <span class="ot">&lt;-</span> <span class="fu">get_catalog</span>( <span class="st">&quot;ess&quot;</span> , <span class="at">output_dir =</span> <span class="fu">file.path</span>( <span class="fu">path.expand</span>( <span class="st">&quot;~&quot;</span> ) , <span class="st">&quot;ESS&quot;</span> ) )</span>
<span id="cb32-7"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co"># limit the catalog to only wave #4 for germany and spain</span></span>
<span id="cb32-9"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb32-9" aria-hidden="true" tabindex="-1"></a>ess_cat <span class="ot">&lt;-</span> <span class="fu">subset</span>( ess_cat , wave <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> <span class="fu">grepl</span>( <span class="st">&quot;c=DE|c=ES&quot;</span> , full_url ) )</span>
<span id="cb32-10"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co"># download the ess microdata</span></span>
<span id="cb32-12"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lodown</span>( <span class="st">&quot;ess&quot;</span> , ess_cat , <span class="at">your_email =</span> <span class="st">&quot;email@address.com&quot;</span> )</span></code></pre></div>
<p>Immediately pull the German files into the workspace:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load Germany&#39;s round four main data file..</span></span>
<span id="cb33-2"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb33-2" aria-hidden="true" tabindex="-1"></a>ess4.de <span class="ot">&lt;-</span> <span class="fu">readRDS</span>( <span class="fu">file.path</span>( <span class="fu">path.expand</span>( <span class="st">&quot;~&quot;</span> ) , <span class="st">&quot;ESS&quot;</span> , <span class="st">&quot;2008/ESS4DE.rds&quot;</span> ) )</span>
<span id="cb33-3"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># load Germany&#39;s round four sample design data file (sddf)..</span></span>
<span id="cb33-5"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb33-5" aria-hidden="true" tabindex="-1"></a>ess4.de.sddf <span class="ot">&lt;-</span> <span class="fu">readRDS</span>( <span class="fu">file.path</span>( <span class="fu">path.expand</span>( <span class="st">&quot;~&quot;</span> ) , <span class="st">&quot;ESS&quot;</span> , <span class="st">&quot;2008/ESS4_DE_SDDF.rds&quot;</span> ) )</span></code></pre></div>
<p>The stratify variable is not literally equal to the actual strata but contains more information (which we don’t need here). Create a new variable that only uses the actual stratification namely, East v. West Germany, by using a regular expression / string substitution function to take the data.frame object’s <code>stratify</code> variable, convert it to a character variable, search for a dash, and keep only the text before the dash. Then, convert that resultant vector of ones and twos into a factor variable, labeled East versus West Germany.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb34-1" aria-hidden="true" tabindex="-1"></a>ess4.de.sddf<span class="sc">$</span>stratify <span class="ot">&lt;-</span> </span>
<span id="cb34-2"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">factor</span>( <span class="fu">gsub</span>( <span class="st">&quot;(</span><span class="sc">\\</span><span class="st">d+)-.+&quot;</span> , <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&quot;</span> , <span class="fu">as.character</span>( ess4.de.sddf<span class="sc">$</span>stratify ) ) )</span>
<span id="cb34-3"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(ess4.de.sddf<span class="sc">$</span>stratify) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;West Germany&quot;</span>, <span class="st">&quot;East Germany&quot;</span>)</span></code></pre></div>
<p>Check against <a href="www.europeansocialsurvey.org/docs/round4/survey/ESS4_data_documentation_report_e05_4.pdf#page=121">ESS documentation</a> statement that “The number of sampling points is 109 in the West, and 59 in the East”:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">tapply</span>(ess4.de.sddf<span class="sc">$</span>psu, </span>
<span id="cb35-2"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb35-2" aria-hidden="true" tabindex="-1"></a>                 ess4.de.sddf<span class="sc">$</span>stratify, </span>
<span id="cb35-3"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb35-3" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">function</span>(x) <span class="fu">length</span>(<span class="fu">unique</span>(x))) <span class="sc">==</span> <span class="fu">c</span>(<span class="dv">109</span>, <span class="dv">59</span>))</span></code></pre></div>
<p>Merge these two files together, creating a single table:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb36-1" aria-hidden="true" tabindex="-1"></a>ess4.de.m <span class="ot">&lt;-</span> <span class="fu">merge</span>( ess4.de , ess4.de.sddf)</span>
<span id="cb36-2"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>( </span>
<span id="cb36-4"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>( ess4.de ) <span class="sc">==</span> <span class="fu">nrow</span>( ess4.de.m ) <span class="sc">&amp;</span> </span>
<span id="cb36-5"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>( ess4.de.sddf ) <span class="sc">==</span> <span class="fu">nrow</span>( ess4.de.m ) </span>
<span id="cb36-6"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb36-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Create a survey design object:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb37-1" aria-hidden="true" tabindex="-1"></a>ess4.de.design <span class="ot">&lt;-</span> </span>
<span id="cb37-2"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">svydesign</span>(</span>
<span id="cb37-3"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb37-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">ids =</span> <span class="sc">~</span>psu ,</span>
<span id="cb37-4"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb37-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">strata =</span> <span class="sc">~</span>stratify ,</span>
<span id="cb37-5"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb37-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">probs =</span> <span class="sc">~</span>prob ,</span>
<span id="cb37-6"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb37-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> ess4.de.m</span>
<span id="cb37-7"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb37-7" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
</div>
<div id="two-factor-cfa-of-attitudes-toward-the-welfare-state" class="section level2 unnumbered hasAnchor">
<h2>Two-factor CFA of attitudes toward the welfare state<a href="structural-equation-models-sem-with-complex-survey-data.html#two-factor-cfa-of-attitudes-toward-the-welfare-state" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This analysis uses the model of the below article. Please see the article for more information.</p>
<p>Roosma, F., Gelissen, J., &amp; van Oorschot, W. (2013). The multidimensionality of welfare state attitudes: a European cross-national study. Social indicators research, 113(1), 235-255.</p>
<p>Formulate the two-factor CFA using lavaan syntax:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb38-1" aria-hidden="true" tabindex="-1"></a>model.cfa <span class="ot">&lt;-</span>    </span>
<span id="cb38-2"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb38-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;range =~ gvjbevn + gvhlthc + gvslvol + gvslvue + gvcldcr + gvpdlwk</span></span>
<span id="cb38-3"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="st">     goals =~ sbprvpv  +  sbeqsoc  +  sbcwkfm&quot;</span></span></code></pre></div>
<p>Fit the model using lavaan, accounting for possible nonnormality using the MLM estimator:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb39-1" aria-hidden="true" tabindex="-1"></a>fit.cfa.ml <span class="ot">&lt;-</span> </span>
<span id="cb39-2"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb39-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lavaan</span>(</span>
<span id="cb39-3"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb39-3" aria-hidden="true" tabindex="-1"></a>        model.cfa , </span>
<span id="cb39-4"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb39-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> ess4.de.m , </span>
<span id="cb39-5"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb39-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">estimator =</span> <span class="st">&quot;MLM&quot;</span> , </span>
<span id="cb39-6"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb39-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">int.ov.free =</span> <span class="cn">TRUE</span> ,</span>
<span id="cb39-7"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb39-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">auto.var =</span> <span class="cn">TRUE</span> , </span>
<span id="cb39-8"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb39-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">auto.fix.first =</span> <span class="cn">TRUE</span> , </span>
<span id="cb39-9"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb39-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">auto.cov.lv.x =</span> <span class="cn">TRUE</span></span>
<span id="cb39-10"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb39-10" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<p>Show some fit measure results, note the “scaling correction” which accounts for nonnormality:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb40-1" aria-hidden="true" tabindex="-1"></a>fit.cfa.ml</span></code></pre></div>
<p>Fit the two-factor model while taking the survey design into account:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb41-1" aria-hidden="true" tabindex="-1"></a>fit.cfa.surv <span class="ot">&lt;-</span> </span>
<span id="cb41-2"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb41-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lavaan.survey</span>(</span>
<span id="cb41-3"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb41-3" aria-hidden="true" tabindex="-1"></a>        fit.cfa.ml , </span>
<span id="cb41-4"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb41-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">survey.design =</span> ess4.de.design</span>
<span id="cb41-5"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb41-5" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<p>Show some fit measure results, “scaling correction” now accounts for both nonnormality and survey design.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb42-1" aria-hidden="true" tabindex="-1"></a>fit.cfa.surv</span></code></pre></div>
<p>Display parameter estimates and standard errors accounting for survey design:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>( fit.cfa.surv , <span class="at">standardized =</span> <span class="cn">TRUE</span> )</span></code></pre></div>
</div>
<div id="invariance-testing-on-schwarz-human-values-while-accounting-for-the-survey-design." class="section level2 unnumbered hasAnchor">
<h2>Invariance testing on Schwarz human values while accounting for the survey design.<a href="structural-equation-models-sem-with-complex-survey-data.html#invariance-testing-on-schwarz-human-values-while-accounting-for-the-survey-design." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For more information on this analysis, see: Davidov, E., Schmidt, P., &amp; Schwartz, S. H. (2008). “Bringing values back in: The adequacy of the European Social Survey to measure values in 20 countries”. Public opinion quarterly, 72(3), 420-445.</p>
<p>Test the measurement equivalence of Schwarz human values from round 4 of the ESS, comparing Germany with Spain.</p>
<p>First load the Spanish data so these can be merged:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load Spain&#39;s round four main data file..</span></span>
<span id="cb44-2"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb44-2" aria-hidden="true" tabindex="-1"></a>ess4.es <span class="ot">&lt;-</span> <span class="fu">readRDS</span>( <span class="fu">file.path</span>( <span class="fu">path.expand</span>( <span class="st">&quot;~&quot;</span> ) , <span class="st">&quot;ESS&quot;</span> , <span class="st">&quot;2008/ESS4ES.rds&quot;</span> ) )</span>
<span id="cb44-3"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># load Spain&#39;s round four sample design data file (sddf)..</span></span>
<span id="cb44-5"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb44-5" aria-hidden="true" tabindex="-1"></a>ess4.es.sddf <span class="ot">&lt;-</span> <span class="fu">readRDS</span>( <span class="fu">file.path</span>( <span class="fu">path.expand</span>( <span class="st">&quot;~&quot;</span> ) , <span class="st">&quot;ESS&quot;</span> , <span class="st">&quot;2008/ESS4_ES_SDDF.rds&quot;</span> ) )</span></code></pre></div>
<p>Merge these two files together, creating a single table:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb45-1" aria-hidden="true" tabindex="-1"></a>ess4.es.m <span class="ot">&lt;-</span> <span class="fu">merge</span>( ess4.es , ess4.es.sddf)</span>
<span id="cb45-2"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>( </span>
<span id="cb45-4"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb45-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>( ess4.es ) <span class="sc">==</span> <span class="fu">nrow</span>( ess4.es.m ) <span class="sc">&amp;</span> </span>
<span id="cb45-5"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb45-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>( ess4.es.sddf ) <span class="sc">==</span> <span class="fu">nrow</span>( ess4.es.m ) </span>
<span id="cb45-6"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb45-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Make sure PSU names are unique between the two countries. Paste on a “de-” to the German PSUs, and by pasting an “es-” to the front of the Spanish PSUs.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb46-1" aria-hidden="true" tabindex="-1"></a>ess4.de.m<span class="sc">$</span>psu <span class="ot">&lt;-</span> <span class="fu">paste</span>( <span class="st">&quot;de&quot;</span> , ess4.de.m<span class="sc">$</span>psu , <span class="at">sep=</span><span class="st">&quot;-&quot;</span> )</span>
<span id="cb46-2"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb46-2" aria-hidden="true" tabindex="-1"></a>ess4.es.m<span class="sc">$</span>psu <span class="ot">&lt;-</span> <span class="fu">paste</span>( <span class="st">&quot;es&quot;</span> , ess4.es.m<span class="sc">$</span>psu , <span class="at">sep=</span><span class="st">&quot;-&quot;</span> )</span></code></pre></div>
<p>Stack the two countries into a single table, then construct a survey design:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb47-1" aria-hidden="true" tabindex="-1"></a>ess4.m <span class="ot">&lt;-</span> <span class="fu">rbind</span>( ess4.de.m , ess4.es.m )</span>
<span id="cb47-2"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb47-3" aria-hidden="true" tabindex="-1"></a>ess4.design <span class="ot">&lt;-</span> </span>
<span id="cb47-4"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">svydesign</span>(</span>
<span id="cb47-5"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb47-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">ids =</span> <span class="sc">~</span>psu,</span>
<span id="cb47-6"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb47-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">strata =</span> <span class="sc">~</span>stratify ,</span>
<span id="cb47-7"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb47-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">probs =</span> <span class="sc">~</span>prob ,</span>
<span id="cb47-8"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb47-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> ess4.m</span>
<span id="cb47-9"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb47-9" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<p>Model based on Schwarz human value theory. Note that this is the basic starting model, not the final model used by Davidov et al. They merge certain values and allow cross-loadings:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb48-1" aria-hidden="true" tabindex="-1"></a>free.values.model.syntax <span class="ot">&lt;-</span> <span class="st">&quot; </span></span>
<span id="cb48-2"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="st">  Universalism =~ ipeqopt + ipudrst + impenv</span></span>
<span id="cb48-3"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="st">  Benevolence  =~ iphlppl + iplylfr</span></span>
<span id="cb48-4"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="st">  Tradition    =~ ipmodst + imptrad</span></span>
<span id="cb48-6"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="st">  Conformity   =~ ipfrule + ipbhprp </span></span>
<span id="cb48-7"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="st">  Security     =~ impsafe + ipstrgv</span></span>
<span id="cb48-8"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span></code></pre></div>
<p>Fit two-group configural invariance model:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb49-1" aria-hidden="true" tabindex="-1"></a>free.values.fit <span class="ot">&lt;-</span> </span>
<span id="cb49-2"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb49-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lavaan</span>(</span>
<span id="cb49-3"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb49-3" aria-hidden="true" tabindex="-1"></a>        free.values.model.syntax , </span>
<span id="cb49-4"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb49-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> ess4.m , </span>
<span id="cb49-5"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb49-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">auto.cov.lv.x =</span> <span class="cn">TRUE</span> , </span>
<span id="cb49-6"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb49-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">auto.fix.first =</span> <span class="cn">TRUE</span> , </span>
<span id="cb49-7"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb49-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">auto.var =</span> <span class="cn">TRUE</span> ,</span>
<span id="cb49-8"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb49-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">int.ov.free =</span> <span class="cn">TRUE</span> , </span>
<span id="cb49-9"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb49-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">estimator =</span> <span class="st">&quot;MLM&quot;</span> ,</span>
<span id="cb49-10"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb49-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">group =</span> <span class="st">&quot;cntry&quot;</span></span>
<span id="cb49-11"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb49-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb49-12"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb49-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-13"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>( free.values.fit , <span class="at">standardized =</span> <span class="cn">TRUE</span> )</span></code></pre></div>
<p>Fit a two-group metric invariance model:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb50-1" aria-hidden="true" tabindex="-1"></a>free.values.fit.eq <span class="ot">&lt;-</span> </span>
<span id="cb50-2"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb50-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lavaan</span>(</span>
<span id="cb50-3"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb50-3" aria-hidden="true" tabindex="-1"></a>        free.values.model.syntax , </span>
<span id="cb50-4"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb50-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> ess4.m , </span>
<span id="cb50-5"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb50-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">auto.cov.lv.x =</span> <span class="cn">TRUE</span> , </span>
<span id="cb50-6"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb50-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">auto.fix.first =</span> <span class="cn">TRUE</span> , </span>
<span id="cb50-7"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb50-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">auto.var =</span> <span class="cn">TRUE</span> ,</span>
<span id="cb50-8"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb50-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">int.ov.free =</span> <span class="cn">TRUE</span> , </span>
<span id="cb50-9"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb50-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">estimator =</span> <span class="st">&quot;MLM&quot;</span> ,</span>
<span id="cb50-10"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb50-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">group =</span> <span class="st">&quot;cntry&quot;</span> , </span>
<span id="cb50-11"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb50-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">group.equal =</span> <span class="st">&quot;loadings&quot;</span></span>
<span id="cb50-12"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb50-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb50-13"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb50-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-14"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>( free.values.fit.eq , <span class="at">standardized =</span> <span class="cn">TRUE</span> )</span></code></pre></div>
<p>Metric invariance test (anova() would work here too, but not below):</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lavTestLRT</span>( free.values.fit , free.values.fit.eq , <span class="at">SB.classic =</span> <span class="cn">TRUE</span> )</span></code></pre></div>
<p>Compare chisquares of the survey and non-survey SEM analyses for the configural invariance model:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb52-1" aria-hidden="true" tabindex="-1"></a>free.values.fit.surv <span class="ot">&lt;-</span> <span class="fu">lavaan.survey</span>( free.values.fit , ess4.design )</span>
<span id="cb52-2"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb52-2" aria-hidden="true" tabindex="-1"></a>free.values.fit</span>
<span id="cb52-3"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb52-3" aria-hidden="true" tabindex="-1"></a>free.values.fit.surv</span></code></pre></div>
<p>Compare chisquares of the survey and non-survey SEM analyses for the metric invariance model:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb53-1" aria-hidden="true" tabindex="-1"></a>free.values.fit.eq.surv <span class="ot">&lt;-</span> <span class="fu">lavaan.survey</span>( free.values.fit.eq , ess4.design )</span>
<span id="cb53-2"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb53-2" aria-hidden="true" tabindex="-1"></a>free.values.fit.eq</span>
<span id="cb53-3"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb53-3" aria-hidden="true" tabindex="-1"></a>free.values.fit.eq.surv</span></code></pre></div>
<p>Perform metric invariance test accounting for the survey design:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lavTestLRT</span>(free.values.fit.surv, free.values.fit.eq.surv, <span class="at">SB.classic =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>The two models are more dissimilar after survey design is accounted for.</p>
</div>
<div id="an-example-with-a-latent-variable-regression" class="section level2 unnumbered hasAnchor">
<h2>An example with a Latent Variable Regression<a href="structural-equation-models-sem-with-complex-survey-data.html#an-example-with-a-latent-variable-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>See</p>
<p>Davidov, E., Meuleman, B., Billiet, J., &amp; Schmidt, P. (2008). Values and support for immigration: A cross-country comparison. European Sociological Review, 24(5), 583-599.</p>
<p>The human values scale again, but this time:</p>
<ol style="list-style-type: decimal">
<li>only two value dimensions are modeled.</li>
<li>the two latent value dimensions are used to predict anti-immigration attitudes in the two countries.</li>
<li>a test is performed on the difference between countries in latent regression coefficients.</li>
</ol>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-1" aria-hidden="true" tabindex="-1"></a>reg.syntax <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb55-2"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="st">  SelfTranscendence =~ ipeqopt + ipudrst + impenv + iphlppl + iplylfr</span></span>
<span id="cb55-3"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="st">  Conservation =~ ipmodst + imptrad + ipfrule + ipbhprp + impsafe + ipstrgv</span></span>
<span id="cb55-4"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="st">  ALLOW =~ imdfetn + impcntr</span></span>
<span id="cb55-6"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="st">  ALLOW ~ SelfTranscendence + Conservation</span></span>
<span id="cb55-8"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb55-9"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-10"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-10" aria-hidden="true" tabindex="-1"></a>reg.vals.fit <span class="ot">&lt;-</span> </span>
<span id="cb55-11"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lavaan</span>(</span>
<span id="cb55-12"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-12" aria-hidden="true" tabindex="-1"></a>        reg.syntax , </span>
<span id="cb55-13"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> ess4.m , </span>
<span id="cb55-14"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">group =</span> <span class="st">&quot;cntry&quot;</span> ,</span>
<span id="cb55-15"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">estimator =</span> <span class="st">&quot;MLM&quot;</span> ,</span>
<span id="cb55-16"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">auto.cov.lv.x =</span> <span class="cn">TRUE</span> , </span>
<span id="cb55-17"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">auto.fix.first =</span> <span class="cn">TRUE</span> , </span>
<span id="cb55-18"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">auto.var =</span> <span class="cn">TRUE</span> , </span>
<span id="cb55-19"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">int.ov.free =</span> <span class="cn">TRUE</span></span>
<span id="cb55-20"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb55-21"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-22"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-22" aria-hidden="true" tabindex="-1"></a>reg.vals.fit.eq <span class="ot">&lt;-</span> </span>
<span id="cb55-23"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lavaan</span>( </span>
<span id="cb55-24"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-24" aria-hidden="true" tabindex="-1"></a>        reg.syntax , </span>
<span id="cb55-25"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> ess4.m , </span>
<span id="cb55-26"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">group =</span> <span class="st">&quot;cntry&quot;</span> , </span>
<span id="cb55-27"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">group.equal =</span> <span class="st">&quot;regressions&quot;</span> ,</span>
<span id="cb55-28"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">estimator =</span> <span class="st">&quot;MLM&quot;</span> ,</span>
<span id="cb55-29"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">auto.cov.lv.x =</span> <span class="cn">TRUE</span> , </span>
<span id="cb55-30"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">auto.fix.first =</span> <span class="cn">TRUE</span> , </span>
<span id="cb55-31"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">auto.var =</span> <span class="cn">TRUE</span> , </span>
<span id="cb55-32"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">int.ov.free =</span> <span class="cn">TRUE</span></span>
<span id="cb55-33"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-33" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb55-34"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-35"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-36"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb55-36" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>( reg.vals.fit.eq , <span class="at">standardize =</span> <span class="cn">TRUE</span> )</span></code></pre></div>
<p>Test whether the relationship between values and anti-immigration attitudes is equal in Germany and Spain:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lavTestLRT</span>( reg.vals.fit , reg.vals.fit.eq , <span class="at">SB.classic =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Now do the same but accounting for the sampling design:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb57-1" aria-hidden="true" tabindex="-1"></a>reg.vals.fit.surv <span class="ot">&lt;-</span> <span class="fu">lavaan.survey</span>( reg.vals.fit , ess4.design )</span>
<span id="cb57-2"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb57-2" aria-hidden="true" tabindex="-1"></a>reg.vals.fit.eq.surv <span class="ot">&lt;-</span> <span class="fu">lavaan.survey</span>( reg.vals.fit.eq , ess4.design )</span>
<span id="cb57-3"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="structural-equation-models-sem-with-complex-survey-data.html#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lavTestLRT</span>(reg.vals.fit.surv, reg.vals.fit.eq.surv, <span class="at">SB.classic =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>The two models are less dissimilar after survey design is accounted for.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="american-community-survey-acs.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="trend-analysis-across-multiple-years-of-complex-survey-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ajdamico/asdfree/edit/master/lavaanex.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
