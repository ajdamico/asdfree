

https://data.hrsa.gov//DataDownload/DD_Files/Nursing_Workforce_2022_NSSRN_Dashboard_Data.xlsx

nssrn_url <- "https://data.hrsa.gov/DataDownload/NSSRN/GeneralPUF22/2022_NSSRN_PUF_Stata_Package.zip"
tf <- tempfile()
# options(timeout=999)
download.file( nssrn_url , tf , mode = 'wb' )
nssrn_zip <- unzip( tf , exdir = tempdir() )
nssrn_zip

library(survey)
library(haven)

nssrn_df <- read_dta( grep( '\\.dta$' , nssrn_zip , ignore.case = TRUE , value = TRUE ) )

names( nssrn_df ) <- tolower( names( nssrn_df ) )

nssrn_df[ , 'one' ] <- 1

nssrn_design <-
    svrepdesign(
        weight = ~rkrnwgta ,
        repweights = 'rkrnwgta[0-9]+' ,
        scale = 4 / 80 ,
        rscales = rep( 1 , 80 ) ,
        mse = TRUE ,
        type = 'JK1' ,
        data = nssrn_df
    )
	
svytotal( ~ one , nssrn_design )

# RNs and not APRNs
# All APRNs
# Nurse practitioners

nssrn_design <-
	update(
		nssrn_design ,
		
		rn_aprn =
			factor( ed_lcrn , levels = 1:2 , labels = c( 'RNs and not APRNs' , 'All APRNs' ) ) ,
		
		nurse_practitioner = as.numeric( lc_np_cert %in% 1 ) ,
		
		age_groups =
			factor(
				findInterval( age_gp_puf , c( 0 , 3 , 5 , 7 , 9 ) ) ,
				levels = 1:5 ,
				labels = 
					c( 
						'34 or younger' ,
						'35 to 44' ,
						'45 to 54' ,
						'55 to 64' ,
						'65 or older'
					)
			)
	)

svyby( ~ one , ~ age_groups , nssrn_design , unwtd.count )
res <- svymean( ~ age_groups , nssrn_design )
SE( res ) / coef( res )





group_by_variable: age_groups

categorical_variable: STATE

linear_variable: pn_earn_puf
linear_narm: , na.rm = TRUE

ratio_estimation_numerator: pn_earn_puf
ratio_estimation_denominator: pn_hrs_wrk_puf
ratio_narm: , na.rm = TRUE

subset_definition: lc_np_cert %in% 1
subset_definition_description: nurse practitioners

binary_variable: rn_aprn


